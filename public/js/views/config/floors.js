(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{187:function(n,o,t){"use strict";t.r(o);var r=t(1),e=t.n(r),a=t(3),i=t(4);function s(n,o,t,r,e,a,i){try{var s=n[a](i),l=s.value}catch(n){return void t(n)}s.done?o(l):Promise.resolve(l).then(r,e)}function l(n){return function(){var o=this,t=arguments;return new Promise((function(r,e){var a=n.apply(o,t);function i(n){s(a,r,e,i,l,"next",n)}function l(n){s(a,r,e,i,l,"throw",n)}i(void 0)}))}}var d="/api/floors",f={title:"Floors Setup",props:["bldg_id","bldg_name"],components:{CircleProgress:a.b,Loader:a.c,Modal:a.e},data:function(){return{bldgName:null,floors:[],floor:null,listTransition:"fadeUp",loaded:!1,showEntry:!1,editMode:!1,entry:{id:null,fNo:1},showPlan:!1,planUrl:null,state:{saving:!1,imgLoaded:!1}}},computed:{baseUrl:function(){return Object(i.b)()},building:function(){return this.bldg_name?this.bldg_name:this.bldgName},floorList:function(){return this.floors.sort((function(n,o){return n.floor_no>o.floor_no?1:n.floor_no<o.floor_no?-1:0}))}},methods:{getBldgName:function(){var n=this;return l(e.a.mark((function o(){var t,r;return e.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,axios.get("/api/locations",{params:{id:n.bldg_id}});case 2:t=o.sent,r=t.data,n.bldgName=r.name;case 5:case"end":return o.stop()}}),o)})))()},getFloors:function(){var n=this;return l(e.a.mark((function o(){var t,r;return e.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,axios.get(d,{params:{bid:n.bldg_id}});case 2:t=o.sent,(r=t.data).forEach((function(n){n.upload_info={uploading:!1,progress:0}})),n.floors=r,n.loaded=!0;case 7:case"end":return o.stop()}}),o)})))()},toggleEntry:function(n){var o=this;this.showEntry=n,n&&setTimeout((function(){o.$refs.fNo.focus()}),0)},toggleSaving:function(n){this.state.saving=n},triggerAdd:function(){this.entry.id=null,this.entry.fNo=1,this.editMode=!1,this.toggleEntry(!0)},addFloor:function(){var n=this;return l(e.a.mark((function o(){return e.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n.toggleSaving(!0),axios.post(d,{building:n.bldg_id,floor_no:n.entry.fNo}).then((function(o){n.toggleSaving(!1);var t=o.data;t.r&&(t.data.upload_info={uploading:!1,progress:0},n.floors.push(t.data),n.toggleEntry(!1))}));case 2:case"end":return o.stop()}}),o)})))()},triggerEdit:function(n){var o=this.floors.find((function(o){return o.hid===n}));this.entry.id=n,this.entry.fNo=o.floor_no,this.editMode=!0,this.toggleEntry(!0)},upFloor:function(){var n=this;return l(e.a.mark((function o(){return e.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n.toggleSaving(!0),axios.put("".concat(d,"/").concat(n.entry.id),{floor_no:n.entry.fNo}).then((function(o){if(n.toggleSaving(!1),o.data.r){var t=n.floors.find((function(o){return o.hid==n.entry.id}));t.floor_no=n.entry.fNo,t.ordinal_no=Object(i.g)(t.floor_no),n.toggleEntry(!1)}}));case 2:case"end":return o.stop()}}),o)})))()},delFloor:function(n){var o=this;return l(e.a.mark((function t(){var r;return e.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=o.floors.findIndex((function(o){return o.hid===n})),confirm("Remove Floor ".concat(o.floors[r].floor_no,"?"))&&(o.toggleSaving(!0),axios.delete("".concat(d,"/").concat(n)).then((function(n){o.toggleSaving(!1),n.data.r&&o.floors.splice(r,1)})));case 2:case"end":return t.stop()}}),t)})))()},upFloorPlan:function(n){this.entry.id=n,this.$refs.fpFile.click()},fpFileChange:function(){var n=this,o=n.$refs.fpFile.files[0];if(o){var t=n.floors.find((function(o){return o.hid===n.entry.id}));t.upload_info.uploading=!0,n.upload(o,(function(n,o){t.upload_info.uploading=!1,n?o.r&&(t.floor_plan=o.floor_plan):console.error(o)}))}},upload:function(n,o){var t=this;return l(e.a.mark((function r(){var a,i;return e.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=new window.FormData,i=t.floors.find((function(n){return n.hid===t.entry.id})),a.append("floor_plan",n),a.append("id",t.entry.id),axios.post("".concat(d,"/plan"),a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(n){var o=Math.round(100*n.loaded/n.total);i.upload_info.progress=o}}).then((function(n){return o(!0,n.data)})).catch((function(n){return o(!1,n)}));case 4:case"end":return r.stop()}}),r)})))()},togglePlan:function(n){this.showPlan=n,this.listTransition="fade"},viewFloorPlan:function(n,o){var t=this;t.floor=t.floors.find((function(o){return o.hid===n})),t.togglePlan(!0),t.state.imgLoaded=!1,Object(i.e)("".concat(t.baseUrl,"/plans/").concat(t.floor.floor_plan),(function(){t.state.imgLoaded=!0}))},toMapper:function(n){this.$parent.$router.push({name:"mapper",query:{fid:n},params:{bid:this.bldg_id,bldg_name:this.bldg_name}})}},created:function(){this.bldg_name||this.getBldgName()},mounted:function(){this.getFloors()}},c=(t(83),t(2)),p=Object(c.a)(f,(function(){var n=this,o=n.$createElement,t=n._self._c||o;return t("div",{staticClass:"content"},[t("h1",[n._v(n._s(n.building?"Floors - "+n.building:"Floors"))]),n._v(" "),t("transition",{attrs:{name:"fadeUp",appear:""}},[n.loaded?t("div",{attrs:{id:"list-wrapper"}},[t("div",{attrs:{id:"floor-list"}},[0===n.floorList.length?t("div",[n._v("No floors defined")]):n._l(n.floorList,(function(o){return t("div",{key:o.hid,staticClass:"floor"},[t("div",{staticClass:"floor-thumb"},[o.upload_info.uploading?t("div",{staticClass:"fp-upload-progress"},[n._v("\n                            Uploading\n                            "),t("circle-progress",{attrs:{percent:o.upload_info.progress}})],1):n._e(),n._v(" "),o.floor_plan?t("div",{staticClass:"fp-thumb"},[t("img",{attrs:{src:n.baseUrl+"/plans/thumbnail/"+o.floor_plan}}),n._v(" "),t("div",{staticClass:"fp-thumb-opts"},[t("a",{on:{click:function(t){return n.upFloorPlan(o.hid)}}},[n._v("Change")]),n._v(" "),t("a",{on:{click:function(t){return n.viewFloorPlan(o.hid,o.floor_plan)}}},[n._v("Preview")])])]):t("div",{staticClass:"fp-upload-trigger",on:{click:function(t){return n.upFloorPlan(o.hid)}}},[n._v("\n                            Upload Floor Plan\n                        ")])]),n._v(" "),t("div",{staticClass:"floor-info"},[n._v("\n                        "+n._s(o.ordinal_no+" Floor")+"\n                        "),t("div",{staticClass:"floor-opts"},[o.floor_plan?[t("a",{staticClass:"floor-opt",on:{click:function(t){return n.toMapper(o.hid)}}},[n._v("Mapper")])]:n._e(),n._v(" "),t("a",{staticClass:"floor-opt",on:{click:function(t){return n.triggerEdit(o.hid)}}},[n._v("Edit")]),n._v(" "),t("a",{staticClass:"floor-opt",on:{click:function(t){return n.delFloor(o.hid)}}},[n._v("Remove")])],2)])])}))],2),n._v(" "),t("input",{ref:"fpFile",attrs:{type:"file",hidden:"",accept:"image/*"},on:{change:n.fpFileChange}}),n._v(" "),t("button",{staticClass:"btn btn-primary",attrs:{id:"add-btn"},on:{click:n.triggerAdd}},[n._v("Add Floor")]),n._v(" "),n.showPlan?t("div",{staticClass:"fp-preview"},[t("loader",{attrs:{show:!n.state.imgLoaded,type:"spinner"}}),n._v(" "),n.state.imgLoaded?t("img",{attrs:{src:n.baseUrl+"/plans/"+n.floor.floor_plan}}):n._e(),n._v(" "),t("div",{staticClass:"preview-header"},[n._v("\n                    "+n._s(n.building+" - "+n.floor.ordinal_no+" Floor")+"\n                    "),t("span",{staticClass:"preview-close",on:{click:function(o){return n.togglePlan(!1)}}},[n._v("Close")])])],1):n._e()]):n._e()]),n._v(" "),t("modal",{attrs:{show:n.showEntry},on:{close:function(o){return n.toggleEntry(!1)}},scopedSlots:n._u([{key:"header",fn:function(){return[t("h2",[n._v(n._s(n.editMode?"Edit":"Add")+" Floor")])]},proxy:!0},{key:"footer",fn:function(){return[n.editMode?t("button",{staticClass:"btn btn-primary",attrs:{disabled:n.state.saving},on:{click:n.upFloor}},[n._v(n._s(n.state.saving?"Updating...":"Update"))]):t("button",{staticClass:"btn btn-primary",attrs:{disabled:n.state.saving},on:{click:n.addFloor}},[n._v(n._s(n.state.saving?"Adding...":"Add"))])]},proxy:!0}])},[n._v(" "),t("div",{attrs:{id:"entry-wrapper"}},[t("div",{staticClass:"input-field"},[t("label",[n._v("Floor No.")]),n._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.entry.fNo,expression:"entry.fNo"}],ref:"fNo",attrs:{type:"number"},domProps:{value:n.entry.fNo},on:{input:function(o){o.target.composing||n.$set(n.entry,"fNo",o.target.value)}}})])])]),n._v(" "),t("loader",{attrs:{show:!n.loaded,type:"ripple"}})],1)}),[],!1,null,"06dc09af",null);o.default=p.exports},19:function(n,o,t){var r=t(84);"string"==typeof r&&(r=[[n.i,r,""]]);var e={hmr:!0,transform:void 0,insertInto:void 0};t(8)(r,e);r.locals&&(n.exports=r.locals)},83:function(n,o,t){"use strict";var r=t(19);t.n(r).a},84:function(n,o,t){(n.exports=t(7)(!1)).push([n.i,"#floor-list[data-v-06dc09af] {\n  margin-top: 24px;\n}\n#add-btn[data-v-06dc09af] {\n  margin-top: 24px;\n}\n.floor[data-v-06dc09af] {\n  position: relative;\n  display: inline-block;\n  flex-direction: column;\n  font-size: 20px;\n  padding: 10px;\n  border-radius: 10px;\n  margin-right: 10px;\n  transition: background-color 0.24s linear;\n}\n.floor[data-v-06dc09af]:hover {\n  background-color: rgba(255, 255, 255, 0.04);\n}\n.floor .floor-thumb[data-v-06dc09af] {\n  position: relative;\n  width: 200px;\n  height: 135px;\n  overflow: hidden;\n}\n.floor .floor-thumb .fp-upload-progress[data-v-06dc09af] {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n  background-color: rgba(57, 57, 57, 0.8);\n  z-index: 1;\n}\n.floor .floor-thumb .fp-upload-trigger[data-v-06dc09af] {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: calc(100% - 2px);\n  font-size: 14px;\n  cursor: pointer;\n  border: 1px dashed rgba(255, 255, 255, 0.1);\n}\n.floor .floor-thumb .fp-thumb[data-v-06dc09af] {\n  position: relative;\n  height: 135px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #ffffff;\n}\n.floor .floor-thumb .fp-thumb img[data-v-06dc09af] {\n  display: block;\n  height: auto;\n  max-width: 100%;\n  margin: 0 auto;\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.floor .floor-thumb .fp-thumb .fp-thumb-opts[data-v-06dc09af] {\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  padding: 2px 6px 6px;\n  background-color: rgba(57, 57, 57, 0.8);\n  transform: translateY(100%);\n  transition: transform 0.24s;\n}\n.floor .floor-thumb .fp-thumb .fp-thumb-opts a[data-v-06dc09af] {\n  display: inline-block;\n  font-size: 14px;\n  cursor: pointer;\n}\n.floor .floor-thumb .fp-thumb .fp-thumb-opts a + a[data-v-06dc09af] {\n  margin-left: 4px;\n}\n.floor .floor-thumb .fp-thumb .fp-thumb-opts a[data-v-06dc09af]:hover {\n  text-decoration: underline;\n}\n.floor .floor-thumb .fp-thumb:hover .fp-thumb-opts[data-v-06dc09af] {\n  transform: translateY(0);\n}\n.floor .floor-info[data-v-06dc09af] {\n  flex: 1 auto;\n  padding: 10px;\n}\n.floor .floor-opts[data-v-06dc09af] {\n  line-height: 13px;\n}\n.floor .floor-opts .floor-opt[data-v-06dc09af] {\n  font-size: 13px;\n  cursor: pointer;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.floor .floor-opts .floor-opt + .floor-opt[data-v-06dc09af] {\n  margin-left: 4px;\n}\n.floor .floor-opts .floor-opt[data-v-06dc09af]:hover {\n  text-decoration: underline;\n}\n.fp-preview[data-v-06dc09af] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(20, 20, 20, 0.85);\n}\n.fp-preview .preview-header[data-v-06dc09af] {\n  position: relative;\n  font-size: 18px;\n  padding: 10px;\n  line-height: 24px;\n  background-color: rgba(20, 20, 20, 0.7);\n  z-index: 1;\n}\n.fp-preview .preview-header .preview-close[data-v-06dc09af] {\n  float: right;\n  cursor: pointer;\n  font-size: 14px;\n  padding: 0 8px;\n}\n.fp-preview img[data-v-06dc09af] {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  max-height: 90%;\n  max-width: 90%;\n  transform: translate(-50%, -50%);\n  background-color: #ffffff;\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  z-index: -1;\n}",""])}}]);