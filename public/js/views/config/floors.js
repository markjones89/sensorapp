(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{116:function(t,o,e){"use strict";var n=e(33);e.n(n).a},117:function(t,o,e){(t.exports=e(7)(!1)).push([t.i,"#add-btn[data-v-59aa0ef9],#floor-list[data-v-59aa0ef9]{margin-top:24px}.floor[data-v-59aa0ef9]{position:relative;display:inline-block;flex-direction:column;font-size:20px;padding:10px;border-radius:10px;margin-right:10px;transition:background-color .24s linear}.floor[data-v-59aa0ef9]:hover{background-color:hsla(0,0%,100%,.04)}.floor .floor-thumb[data-v-59aa0ef9]{position:relative;width:200px;height:135px;overflow:hidden}.floor .floor-thumb .fp-upload-progress[data-v-59aa0ef9]{position:absolute;top:0;bottom:0;left:0;right:0;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:14px;background-color:rgba(57,57,57,.8);z-index:1}.floor .floor-thumb .fp-upload-trigger[data-v-59aa0ef9]{display:flex;justify-content:center;align-items:center;height:calc(100% - 2px);font-size:14px;cursor:pointer;border:1px dashed hsla(0,0%,100%,.1)}.floor .floor-thumb .fp-thumb[data-v-59aa0ef9]{position:relative;height:135px;display:flex;justify-content:center;align-items:center;background-color:#fff}.floor .floor-thumb .fp-thumb img[data-v-59aa0ef9]{display:block;height:auto;max-width:100%;margin:0 auto;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.floor .floor-thumb .fp-thumb .fp-thumb-opts[data-v-59aa0ef9]{position:absolute;left:0;bottom:0;right:0;padding:2px 6px 6px;background-color:rgba(57,57,57,.8);transform:translateY(100%);transition:transform .24s}.floor .floor-thumb .fp-thumb .fp-thumb-opts a[data-v-59aa0ef9]{display:inline-block;font-size:14px;cursor:pointer}.floor .floor-thumb .fp-thumb .fp-thumb-opts a+a[data-v-59aa0ef9]{margin-left:4px}.floor .floor-thumb .fp-thumb .fp-thumb-opts a[data-v-59aa0ef9]:hover{text-decoration:underline}.floor .floor-thumb .fp-thumb:hover .fp-thumb-opts[data-v-59aa0ef9]{transform:translateY(0)}.floor .floor-info[data-v-59aa0ef9]{flex:1 auto;padding:10px}.floor .floor-opts[data-v-59aa0ef9]{line-height:13px}.floor .floor-opts .floor-opt[data-v-59aa0ef9]{font-size:13px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.floor .floor-opts .floor-opt+.floor-opt[data-v-59aa0ef9]{margin-left:4px}.floor .floor-opts .floor-opt[data-v-59aa0ef9]:hover{text-decoration:underline}.fp-preview[data-v-59aa0ef9]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(20,20,20,.85)}.fp-preview .preview-header[data-v-59aa0ef9]{position:relative;font-size:18px;padding:10px;line-height:24px;background-color:rgba(20,20,20,.7);z-index:1}.fp-preview .preview-header .preview-close[data-v-59aa0ef9]{float:right;cursor:pointer;font-size:14px;padding:0 8px}.fp-preview img[data-v-59aa0ef9]{position:absolute;top:50%;left:50%;max-height:90%;max-width:90%;transform:translate(-50%,-50%);background-color:#fff;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:-1}",""])},223:function(t,o,e){"use strict";e.r(o);var n=e(1),r=e.n(n),a=e(4),i=e(2),s=e(5);function l(t,o,e,n,r,a,i){try{var s=t[a](i),l=s.value}catch(t){return void e(t)}s.done?o(l):Promise.resolve(l).then(n,r)}function f(t){return function(){var o=this,e=arguments;return new Promise((function(n,r){var a=t.apply(o,e);function i(t){l(a,n,r,i,s,"next",t)}function s(t){l(a,n,r,i,s,"throw",t)}i(void 0)}))}}var d="/api/floors",c={title:"Floors Setup",props:["bldg_id","bldg_name"],components:{CircleProgress:i.b,Loader:i.e,Modal:i.g},data:function(){return{bldg:null,floors:[],floor:null,listTransition:"fadeUp",loaded:!1,showEntry:!1,editMode:!1,entry:{id:null,fNo:1,size_metre:0,size_feet:0,occupancy_limit:0},showPlan:!1,planUrl:null,state:{saving:!1,imgLoaded:!1}}},computed:{baseUrl:function(){return Object(s.c)()},floorList:function(){return this.floors.sort((function(t,o){return t.floor_no>o.floor_no?1:t.floor_no<o.floor_no?-1:0}))}},methods:{getBuilding:function(t,o){var e=this;return f(r.a.mark((function n(){var i,s;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,axios.get("/api/locations",{params:{id:t}});case 2:return i=n.sent,s=i.data,a.a.setBldg(s),e.bldg=s,n.abrupt("return",o&&o());case 7:case"end":return n.stop()}}),n)})))()},getFloors:function(){var t=this;return f(r.a.mark((function o(){var e,n;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,axios.get(d,{params:{bid:t.bldg_id}});case 2:e=o.sent,(n=e.data).forEach((function(o){o.floor_plan_url="".concat(t.baseUrl,"/plans/").concat(o.floor_plan),o.upload_info={uploading:!1,progress:0}})),a.a.setFloors(n),t.floors=a.a.getFloors(),t.loaded=!0;case 8:case"end":return o.stop()}}),o)})))()},toggleEntry:function(t){var o=this;this.showEntry=t,t&&setTimeout((function(){o.$refs.fNo.focus()}),0)},toggleSaving:function(t){this.state.saving=t},triggerAdd:function(){this.entry.id=null,this.entry.fNo=1,this.entry.size_metre=0,this.entry.size_feet=0,this.entry.occupancy_limit=0,this.editMode=!1,this.toggleEntry(!0)},addFloor:function(){var t=this;return f(r.a.mark((function o(){return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t.toggleSaving(!0),axios.post(d,{building:t.bldg_id,floor_no:t.entry.fNo,size_metre:t.entry.size_metre,size_feet:t.entry.size_feet,occupancy_limit:t.entry.occupancy_limit}).then((function(o){t.toggleSaving(!1);var e=o.data;e.r&&(e.data.upload_info={uploading:!1,progress:0},e.data.floor_plan_url="".concat(t.baseUrl,"/plans/").concat(e.data.floor_plan),t.floors.push(e.data),t.toggleEntry(!1))}));case 2:case"end":return o.stop()}}),o)})))()},triggerEdit:function(t){var o=this.floors.find((function(o){return o.hid===t}));this.entry.id=t,this.entry.fNo=o.floor_no,this.entry.size_metre=o.size_metre,this.entry.size_feet=o.size_feet,this.entry.occupancy_limit=o.occupancy_limit,this.editMode=!0,this.toggleEntry(!0)},upFloor:function(){var t=this;return f(r.a.mark((function o(){return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t.toggleSaving(!0),axios.put("".concat(d,"/").concat(t.entry.id),{floor_no:t.entry.fNo,size_metre:t.entry.size_metre,size_feet:t.entry.size_feet,occupancy_limit:t.entry.occupancy_limit}).then((function(o){if(t.toggleSaving(!1),o.data.r){var e=t.floors.find((function(o){return o.hid==t.entry.id}));e.floor_no=t.entry.fNo,e.size_metre=t.entry.size_metre,e.size_feet=t.entry.size_feet,e.occupancy_limit=t.entry.occupancy_limit,e.ordinal_no=Object(s.h)(e.floor_no),t.toggleEntry(!1)}}));case 2:case"end":return o.stop()}}),o)})))()},delFloor:function(t){var o=this;return f(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(n=o).floors.findIndex((function(o){return o.hid===t})),n.$duDialog(null,"Remove <strong>".concat(n.floors[a].ordinal_no," Floor</strong>?"),n.$duDialog.OK_CANCEL,{okText:"Remove",callbacks:{okClick:function(o){this.hide(),n.toggleSaving(!0),axios.delete("".concat(d,"/").concat(t)).then((function(t){n.toggleSaving(!1),t.data.r&&n.floors.splice(a,1)}))}}});case 2:case"end":return e.stop()}}),e)})))()},upFloorPlan:function(t){this.entry.id=t,this.$refs.fpFile.click()},fpFileChange:function(){var t=this,o=t.$refs.fpFile.files[0];if(o){var e=t.floors.find((function(o){return o.hid===t.entry.id}));e.upload_info.uploading=!0,t.upload(o,(function(o,n){e.upload_info.uploading=!1,o?n.r&&(e.floor_plan=n.floor_plan,e.floor_plan_url="".concat(t.baseUrl,"/plans/").concat(e.floor_plan)):console.error(n)}))}},upload:function(t,o){var e=this;return f(r.a.mark((function n(){var a,i;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=new window.FormData,i=e.floors.find((function(t){return t.hid===e.entry.id})),a.append("floor_plan",t),a.append("id",e.entry.id),axios.post("".concat(d,"/plan"),a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){var o=Math.round(100*t.loaded/t.total);i.upload_info.progress=o}}).then((function(t){return o(!0,t.data)})).catch((function(t){return o(!1,t)}));case 4:case"end":return n.stop()}}),n)})))()},togglePlan:function(t){this.showPlan=t,this.listTransition="fade"},viewFloorPlan:function(t,o){var e=this;e.floor=e.floors.find((function(o){return o.hid===t})),e.togglePlan(!0),e.state.imgLoaded=!1,Object(s.f)(e.floor.floor_plan_url,(function(){e.state.imgLoaded=!0}))},toMapper:function(t){this.$parent.$router.push({name:"mapper",query:{fid:t},params:{bid:this.bldg_id,bldg_name:this.bldg_name}})}},mounted:function(){var t=this,o=a.a.getBldg(),e=a.a.getFloors();o&&o.hid===this.bldg_id?(this.bldg=o,e.length>0?(this.floors=a.a.getFloors(),this.loaded=!0):this.getFloors()):this.getBuilding(this.bldg_id,(function(){t.getFloors()}))}},p=(e(116),e(3)),u=Object(p.a)(c,(function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"content"},[t.loaded?[e("h1",[t._v(t._s(t.bldg?t.bldg.name:""))]),t._v(" "),e("transition",{attrs:{name:"fadeUp",appear:""}},[t.loaded?e("div",{attrs:{id:"list-wrapper"}},[e("div",{attrs:{id:"floor-list"}},[0===t.floorList.length?e("div",[t._v("No floors defined")]):t._l(t.floorList,(function(o){return e("div",{key:o.hid,staticClass:"floor"},[e("div",{staticClass:"floor-thumb"},[o.upload_info.uploading?e("div",{staticClass:"fp-upload-progress"},[t._v("\n                                Uploading\n                                "),e("circle-progress",{attrs:{percent:o.upload_info.progress}})],1):t._e(),t._v(" "),o.floor_plan?e("div",{staticClass:"fp-thumb"},[e("img",{attrs:{src:t.baseUrl+"/plans/thumbnail/"+o.floor_plan}}),t._v(" "),e("div",{staticClass:"fp-thumb-opts"},[e("a",{on:{click:function(e){return t.upFloorPlan(o.hid)}}},[t._v("Change")]),t._v(" "),e("a",{on:{click:function(e){return t.viewFloorPlan(o.hid,o.floor_plan)}}},[t._v("Preview")])])]):e("div",{staticClass:"fp-upload-trigger",on:{click:function(e){return t.upFloorPlan(o.hid)}}},[t._v("\n                                Upload Floor Plan\n                            ")])]),t._v(" "),e("div",{staticClass:"floor-info"},[t._v("\n                            "+t._s(o.ordinal_no+" Floor")+"\n                            "),e("div",{staticClass:"floor-opts"},[o.floor_plan?[e("a",{staticClass:"floor-opt",on:{click:function(e){return t.toMapper(o.hid)}}},[t._v("Mapper")])]:t._e(),t._v(" "),e("a",{staticClass:"floor-opt",on:{click:function(e){return t.triggerEdit(o.hid)}}},[t._v("Edit")]),t._v(" "),e("a",{staticClass:"floor-opt",on:{click:function(e){return t.delFloor(o.hid)}}},[t._v("Remove")])],2)])])}))],2),t._v(" "),e("input",{ref:"fpFile",attrs:{type:"file",hidden:"",accept:"image/*"},on:{change:t.fpFileChange}}),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{id:"add-btn"},on:{click:t.triggerAdd}},[t._v("Add Floor")]),t._v(" "),t.showPlan?e("div",{staticClass:"fp-preview"},[e("loader",{attrs:{show:!t.state.imgLoaded,type:"spinner"}}),t._v(" "),t.state.imgLoaded?e("img",{attrs:{src:t.baseUrl+"/plans/"+t.floor.floor_plan}}):t._e(),t._v(" "),e("div",{staticClass:"preview-header"},[t._v("\n                        "+t._s(t.bldg.name+" - "+t.floor.ordinal_no+" Floor")+"\n                        "),e("span",{staticClass:"preview-close",on:{click:function(o){return t.togglePlan(!1)}}},[t._v("Close")])])],1):t._e()]):t._e()])]:t._e(),t._v(" "),e("modal",{attrs:{show:t.showEntry},on:{close:function(o){return t.toggleEntry(!1)}},scopedSlots:t._u([{key:"header",fn:function(){return[e("h2",[t._v(t._s(t.editMode?"Edit":"Add")+" Floor")])]},proxy:!0},{key:"footer",fn:function(){return[t.editMode?e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.state.saving},on:{click:t.upFloor}},[t._v(t._s(t.state.saving?"Updating...":"Update"))]):e("button",{staticClass:"btn btn-primary",attrs:{disabled:t.state.saving},on:{click:t.addFloor}},[t._v(t._s(t.state.saving?"Adding...":"Add"))])]},proxy:!0}])},[t._v(" "),e("div",{attrs:{id:"entry-wrapper"}},[e("div",{staticClass:"input-field"},[e("label",[t._v("Floor No.")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.entry.fNo,expression:"entry.fNo"}],ref:"fNo",attrs:{type:"number"},domProps:{value:t.entry.fNo},on:{input:function(o){o.target.composing||t.$set(t.entry,"fNo",o.target.value)}}})]),t._v(" "),e("div",{staticClass:"input-field"},[e("label",[t._v("Size (m"),e("sup",[t._v("2")]),t._v(")")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.entry.size_metre,expression:"entry.size_metre"}],attrs:{type:"text"},domProps:{value:t.entry.size_metre},on:{input:function(o){o.target.composing||t.$set(t.entry,"size_metre",o.target.value)}}})]),t._v(" "),e("div",{staticClass:"input-field"},[e("label",[t._v("Size (ft"),e("sup",[t._v("2")]),t._v(")")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.entry.size_feet,expression:"entry.size_feet"}],attrs:{type:"text"},domProps:{value:t.entry.size_feet},on:{input:function(o){o.target.composing||t.$set(t.entry,"size_feet",o.target.value)}}})]),t._v(" "),e("div",{staticClass:"input-field"},[e("label",[t._v("Occupancy Limit")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.entry.occupancy_limit,expression:"entry.occupancy_limit"}],attrs:{type:"number"},domProps:{value:t.entry.occupancy_limit},on:{input:function(o){o.target.composing||t.$set(t.entry,"occupancy_limit",o.target.value)}}})])])]),t._v(" "),e("loader",{attrs:{show:!t.loaded,type:"ripple"}})],2)}),[],!1,null,"59aa0ef9",null);o.default=u.exports},33:function(t,o,e){var n=e(117);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e(8)(n,r);n.locals&&(t.exports=n.locals)}}]);