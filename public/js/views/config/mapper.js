(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{11:function(e,t,r){"use strict";var a=r(0),o=r(5);t.a=function(e,t,r){var n=this,i=a.y(e),s=800,c=400,l=t,u=l.sensors||[],d=l.areas||[],h=Object(o.b)({edit:!1,heatmap:!1,comfortmap:!1},r),p=h.events,f={x:0,y:0,scale:0},v={sensorMapping:!1,showSensors:!1,areaMapping:!1,showAreas:!1,drawing:!1,polyMoved:!1},g=[],m=a.w().domain([0,50]).range([0,s]),w=a.w().domain([0,33.79]).range([0,c]),y=this,b=a.x().domain([0,1,2]).range(["#01FE01","#FF8600","#ED0003"]),k=a.x().domain([0,1,2]).range(["rgba(1,254,1,0.3)","rgba(255,134,0,0.3)","rgba(237,0,3,0.3)"]);i.selectAll("svg").remove(),i.selectAll(".tooltip").remove();var _=i.append("div").attr("class","tooltip"),x=i.append("svg").attr("width",s).attr("height",c).style("display","block").style("background","#ffffff").on("click",(function(){if(h.edit){var e=a.i,t=document.elementFromPoint(e.x,e.y);if("svg"!==t.tagName){var r=E.__transform,o=r?(e.offsetX-r.x)/r.k:e.offsetX,n=r?(e.offsetY-r.y)/r.k:e.offsetY;if((r&&1===r.z||!r)&&(o-=f.x,n-=f.y),v.sensorMapping){var i="polygon"===t.tagName?a.y(t.parentNode).data()[0]:null;return p&&p.sensorAdd&&p.sensorAdd.call(y,{x:o,y:n,scale:f.scale,area:i})}if(v.areaMapping){var s={x:r?(e.offsetX-r.x)/r.k:e.offsetX,y:r?(e.offsetY-r.y)/r.k:e.offsetY},c=M.select("g.area-draw");c.empty()?function(e){v.drawing=!0,B(M.append("g").attr("class","area-draw"),e)}(s):B(c,s)}}}}));(h.heatmap||h.comfortmap)&&x.append("defs").append("filter").attr("id","blur").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%").append("feGaussianBlur").attr("stdDeviation",h.heatmap?7:15);var E=x.selectAll(".map-layer").data([0]).enter().append("g").attr("class","map-layer"),A=E.append("g").attr("class","image-layer"),M=E.append("g").attr("class","area-layer"),S=E.append("g").attr("class","sensor-layer"),C=a.D().scaleExtent([1,8]).on("zoom",(function(){E.__transform=a.i.transform;var e=(1-E.__transform.k)*(m.range()[1]-m.range()[0]),t=(1-E.__transform.k)*(w.range()[1]-w.range()[0]);E.__transform.x=Math.min(m.range()[0],Math.max(E.__transform.x,e)),E.__transform.y=Math.min(w.range()[0],Math.max(E.__transform.y,t)),A.attr("transform",E.__transform),S.attr("transform",E.__transform),M.attr("transform",E.__transform)}));function F(e,t){var r=this,o=new Image;p&&p.imgLoad&&p.imgLoad.call(this,e),o.src=e,o.onload=function(){var e,n,l=i.node().parentNode.getBoundingClientRect().height||400,u=i.node().parentNode.getBoundingClientRect().width||800,d=o.height>l?l/o.height:u/o.width,h=Math.min(Math.min(o.width*d,o.width),u),f=Math.min(Math.min(o.height*d,o.height),l);return s=e=h,c=n=f,m=a.w().domain([0,50]).range([0,e]),w=a.w().domain([0,33.79]).range([0,n]),x.attr("width",e).attr("height",n),p&&p.imgLoaded&&p.imgLoaded.call(r,o),t&&t({height:o.height,width:o.width})}}function D(e){F(l.floor_plan_url,(function(t){var r=c-t.height<s-t.width?c/t.height:s/t.width,a=t.width*r,o=t.height*r,n=(s-a)/2,i=(c-o)/2;f.x=n<0?0:n,f.y=i<0?0:i,f.scale=r,e&&e()}))}function N(e,t,r){r&&_.html(r),_.style("left","".concat(e,"px")).style("top","".concat(t,"px"))}function B(e,t){g.push(t),e.select("polyline").remove(),e.insert("polyline",":first-child").data(g).attr("points",(function(){return g.map((function(e){return[e.x,e.y].join(",")})).join(" ")})).style("fill","none").attr("stroke","#53DBF3"),e.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",4).attr("fill","#FFEB3B").attr("stroke","#53DBF3").style("cursor","pointer").on("click",(function(){return function(){M.select("g.area-draw").remove();var e=(t=g,f.scale,t.map((function(e){return[e.x-f.x,e.y-f.y].join(",")})).join(" "));var t;return $(g),g.splice(0),v.drawing=!1,p&&p.addArea&&p.addArea.call(y,e,f.scale)}()}))}function P(e,t){return e.map((function(e){var r=parseFloat(f.scale.toFixed(12));return[e.x/t*r+f.x,e.y/t*r+f.y].join(",")})).join(" ")}function j(e){return e.map((function(e){return[e.x,e.y].join(",")})).join(" ")}function $(e,t){var r=M.append("g").attr("class",t?"area":"area unsaved"),o=h.edit&&v.areaMapping;r.append("polygon").attr("points",t?P(e,t.scale):j(e)).style("fill","#53DBF3").style("opacity",.2).style("cursor",(function(){return o?"move":v.sensorMapping?"crosshair":"default"})).on("click",(function(e){return o&&(function(e){p&&p.areaClick&&p.areaClick.call(y,e)}(t),a.i.stopPropagation())})).on("mouseover",(function(e){v.sensorMapping||(_.transition().duration(200).style("opacity",.9),N(a.i.offsetX+15,a.i.offsetY-_.node().getBoundingClientRect().height/2,t.name))})).on("mousemove",(function(){v.polyMoved||v.sensorMapping||N(a.i.offsetX+15,a.i.offsetY-_.node().getBoundingClientRect().height/2)})).on("mouseout",(function(){_.transition().duration(200).style("opacity",0)})).call(a.h().on("drag",L).on("end",R));t&&r.data([t]),o&&r.selectAll("circles").data(e).enter().append("circle").attr("cx",(function(e){return t?e.x/t.scale*parseFloat(f.scale.toFixed(12))+f.x:e.x})).attr("cy",(function(e){return t?e.y/t.scale*parseFloat(f.scale.toFixed(12))+f.y:e.y})).attr("r",4).attr("fill","#FFEB3B").attr("stroke","#53DBF3").style("cursor","move").call(a.h().on("drag",T).on("end",O))}function L(){if(h.edit&&v.areaMapping){var e,t=a.i,r=t.dx,o=t.dy,n=a.y(this),i=a.y(this.parentNode).selectAll("circle"),s=[],c=a.y(this.parentNode).data()[0];v.polyMoved=0!==r||0!==o,i.each((function(t){e=a.y(this),t.x+=r,t.y+=o,e.attr("cx",(function(e){return c?t.x/c.scale*parseFloat(f.scale.toFixed(12))+f.x:t.x})).attr("cy",(function(e){return c?t.y/c.scale*parseFloat(f.scale.toFixed(12))+f.y:t.y})),s.push({x:t.x,y:t.y})})),n.attr("points",P(s,c.scale))}}function R(){if(h.edit&&v.areaMapping){var e=a.y(this.parentNode).data()[0],t=a.y(this.parentNode).selectAll("circle"),r=[];if(!v.polyMoved)return;v.polyMoved=!1,t.each((function(e){return r.push({x:e.x,y:e.y})}));var o=j(r);return p&&p.areaPtUpdate&&p.areaPtUpdate.call(y,0===e?null:e,o,f.scale)}}function T(e){e.dragged=!0;var t=a.i,r=a.y(this),o=[],n=a.y(this.parentNode).select("polygon"),i=a.y(this.parentNode).selectAll("circle"),s=a.y(this.parentNode).data()[0];r.attr("cx",t.x+f.x).attr("cy",t.y+f.y),e.x+=t.dx,e.y+=t.dy,i.each((function(e){return o.push({x:e.x,y:e.y})})),n.attr("points",P(o,s.scale))}function O(e){if(e.dragged){e.dragged=!1;var t=[],r=a.y(this.parentNode).selectAll("circle"),o=a.y(this.parentNode).data()[0];r.each((function(e){return t.push({x:e.x,y:e.y})}));var n=j(t);return p&&p.areaPtUpdate&&p.areaPtUpdate.call(y,0===o?null:o,n,f.scale)}}function U(e){h.edit&&v.sensorMapping&&(e.dragged=!0,a.y(this).attr("cx",e.pos_x=a.i.x).attr("cy",e.pos_y=a.i.y))}function X(e){if(h.edit&&v.sensorMapping&&e.dragged)return e.dragged=!1,e.pos_x-=f.x,e.pos_y-=f.y,e.scale=f.scale,p&&p.sensorMoved&&p.sensorMoved.call(y,e)}return E.call(C).on("mousemove",(function(){if(v.drawing){var e=M.select("g.area-draw");e.select("line").remove();var t=g[g.length-1],r=a.i,o=E.__transform,n=o?(r.offsetX-o.x)/o.k:r.offsetX,i=o?(r.offsetY-o.y)/o.k:r.offsetY;e.insert("line",":nth-child(2)").attr("x1",t.x).attr("y1",t.y).attr("x2",n).attr("y2",i).attr("stroke","#53DBF3").attr("stroke-width",1).style("pointer-events","none")}})),this.drawFloorPlan=function(){if(A.selectAll("image").remove(),E.__transform&&A.attr("transform",E.__transform),l.floor_plan){var e=h.edit&&(v.sensorMapping||v.areaMapping);A.insert("image",":first-child").attr("xlink:href",l.floor_plan_url).attr("height",w(33.79)-w(0)).attr("width",m(50)-m(0)).style("cursor",(function(){return e?"crosshair":"default"}))}},this.drawSensors=function(){if(S.selectAll(".sensor").remove(),E.__transform&&S.attr("transform",E.__transform),0!==u.length){var e=h.edit&&v.sensorMapping;S.selectAll(".sensor").data(u).enter().append("circle").attr("class","sensor").attr("data-id",(function(e){return e.hid})).attr("r",h.heatmap?15:h.comfortmap?35:5).attr("stroke-width",h.heatmap||h.comfortmap?null:5).attr("stroke",h.heatmap||h.comfortmap?null:k(0)).style("fill",b(0)).attr("filter",h.heatmap||h.comfortmap?"url(#blur)":null).style("cursor",(function(){return e?"move":"default"})).attr("cx",(function(e){var t=parseFloat(f.scale.toFixed(12));return e.pos_x/e.scale*t+f.x})).attr("cy",(function(e){var t=parseFloat(f.scale.toFixed(12));return e.pos_y/e.scale*t+f.y})).on("mouseover",(function(){if(!h.comfortmap){var e=a.y(this),t=u.find((function(t){return t.hid===e.attr("data-id")}));_.transition().duration(200).style("opacity",.95),N(a.i.offsetX+15,a.i.offsetY-_.node().getBoundingClientRect().height/2,"<div>ID: ".concat(t.sensor_id,"</div><div>Name: ").concat(t.name?t.name:"(None)","</div>"))}})).on("mousemove",(function(){h.comfortmap||N(a.i.offsetX+15,a.i.offsetY-_.node().getBoundingClientRect().height/2)})).on("mouseout",(function(){h.comfortmap||_.transition().duration(200).style("opacity",0)})).on("click",(function(t){return e&&(function(e){p&&p.sensorClick&&p.sensorClick.call(y,e)}(t),a.i.stopPropagation())})).call(a.h().on("drag",U).on("end",X))}},this.setSensorColor=function(e,t){var r="occupied"===t?1:0;S.select('.sensor[data-id="'.concat(e,'"]')).style("fill",b(r)).attr("stroke",k(r))},this.drawAreas=function(){M.selectAll("g.area").remove(),E.__transform&&M.attr("transform",E.__transform),0!==d.length&&d.forEach((function(e){return $(e.poly_points,e)}))},this.setData=function(e){u=(l=e).sensors,d=l.areas,E.__transform=null,this.redraw(!0)},this.redraw=function(e){var t=this;e?(E.__transform=null,E.call(C.transform,a.E),D((function(){t.drawFloorPlan(),t.drawAreas(),t.drawSensors()}))):(this.drawFloorPlan(),this.drawAreas(),this.drawSensors()),this.clearDrawing()},this.editMode=function(e){h.edit=e,this.redraw(!1)},this.setAreaMapping=function(e){e&&(v.sensorMapping=!1),v.areaMapping=e,this.redraw(!1)},this.clearDrawing=function(){v.drawing=!1,g.splice(0),M.select("g.area-draw").remove(),M.select("g.area.unsaved").remove()},this.setSensorMapping=function(e){e&&(v.areaMapping=!1),v.sensorMapping=e,this.redraw(!1)},l&&D((function(){n.drawFloorPlan(),n.drawAreas(),n.drawSensors()})),this}},118:function(e,t,r){"use strict";var a=r(34);r.n(a).a},119:function(e,t,r){(e.exports=r(7)(!1)).push([e.i,'.vue-switcher{position:relative;display:inline-block}.vue-switcher__label{display:block;font-size:10px;margin-bottom:5px}.vue-switcher input{opacity:0;width:100%;height:100%;position:absolute;z-index:1;cursor:pointer}.vue-switcher div{height:15px;width:36px;position:relative;border-radius:30px;display:-ms-flex;display:flex;align-items:center;justify-content:flex-start;cursor:pointer;transition:.2s linear,background-color .2s linear}.vue-switcher div:after{content:"";height:20px;width:20px;border-radius:100px;display:block;transition:.15s linear,background-color .15s linear;position:absolute;left:100%;margin-left:-18px;cursor:pointer;top:-3px;box-shadow:0 1px 5px 0 rgba(0,0,0,.1)}.vue-switcher--unchecked div{justify-content:flex-end}.vue-switcher--unchecked div:after{left:15px}.vue-switcher--disabled div{opacity:.3}.vue-switcher--disabled input{cursor:not-allowed}.vue-switcher--bold div{top:-8px;height:26px;width:51px}.vue-switcher--bold div:after{margin-left:-24px;top:3px}.vue-switcher--bold--unchecked div:after{left:28px}.vue-switcher--bold .vue-switcher__label span{padding-bottom:7px;display:inline-block}.vue-switcher-theme--default.vue-switcher-color--default div{background-color:#b7b7b7}.vue-switcher-theme--default.vue-switcher-color--default div:after{background-color:#9d9d9d}.vue-switcher-theme--default.vue-switcher-color--default.vue-switcher--unchecked div{background-color:#aaa}.vue-switcher-theme--default.vue-switcher-color--default.vue-switcher--unchecked div:after{background-color:#c4c4c4}.vue-switcher-theme--default.vue-switcher-color--blue div{background-color:#77b0c8}.vue-switcher-theme--default.vue-switcher-color--blue div:after{background-color:#539bb9}.vue-switcher-theme--default.vue-switcher-color--blue.vue-switcher--unchecked div{background-color:#c0dae5}.vue-switcher-theme--default.vue-switcher-color--blue.vue-switcher--unchecked div:after{background-color:#77b0c8}.vue-switcher-theme--default.vue-switcher-color--red div{background-color:#c87777}.vue-switcher-theme--default.vue-switcher-color--red div:after{background-color:#b95353}.vue-switcher-theme--default.vue-switcher-color--red.vue-switcher--unchecked div{background-color:#e5c0c0}.vue-switcher-theme--default.vue-switcher-color--red.vue-switcher--unchecked div:after{background-color:#c87777}.vue-switcher-theme--default.vue-switcher-color--yellow div{background-color:#c9c377}.vue-switcher-theme--default.vue-switcher-color--yellow div:after{background-color:#bab353}.vue-switcher-theme--default.vue-switcher-color--yellow.vue-switcher--unchecked div{background-color:#e6e3c0}.vue-switcher-theme--default.vue-switcher-color--yellow.vue-switcher--unchecked div:after{background-color:#c9c377}.vue-switcher-theme--default.vue-switcher-color--orange div{background-color:#c89577}.vue-switcher-theme--default.vue-switcher-color--orange div:after{background-color:#b97953}.vue-switcher-theme--default.vue-switcher-color--orange.vue-switcher--unchecked div{background-color:#e5cec0}.vue-switcher-theme--default.vue-switcher-color--orange.vue-switcher--unchecked div:after{background-color:#c89577}.vue-switcher-theme--default.vue-switcher-color--green div{background-color:#77c88d}.vue-switcher-theme--default.vue-switcher-color--green div:after{background-color:#53b96e}.vue-switcher-theme--default.vue-switcher-color--green.vue-switcher--unchecked div{background-color:#c0e5ca}.vue-switcher-theme--default.vue-switcher-color--green.vue-switcher--unchecked div:after{background-color:#77c88d}.vue-switcher-theme--bulma.vue-switcher-color--default div{background-color:#dcdcdc}.vue-switcher-theme--bulma.vue-switcher-color--default div:after{background-color:#f5f5f5}.vue-switcher-theme--bulma.vue-switcher-color--default.vue-switcher--unchecked div{background-color:#e8e8e8}.vue-switcher-theme--bulma.vue-switcher-color--default.vue-switcher--unchecked div:after{background-color:#f5f5f5}.vue-switcher-theme--bulma.vue-switcher-color--primary div{background-color:#05ffda}.vue-switcher-theme--bulma.vue-switcher-color--primary div:after{background-color:#00d1b2}.vue-switcher-theme--bulma.vue-switcher-color--primary.vue-switcher--unchecked div{background-color:#6bffe9}.vue-switcher-theme--bulma.vue-switcher-color--primary.vue-switcher--unchecked div:after{background-color:#05ffda}.vue-switcher-theme--bulma.vue-switcher-color--blue div{background-color:#5e91e3}.vue-switcher-theme--bulma.vue-switcher-color--blue div:after{background-color:#3273dc}.vue-switcher-theme--bulma.vue-switcher-color--blue.vue-switcher--unchecked div{background-color:#b5ccf2}.vue-switcher-theme--bulma.vue-switcher-color--blue.vue-switcher--unchecked div:after{background-color:#5e91e3}.vue-switcher-theme--bulma.vue-switcher-color--red div{background-color:#ff6b89}.vue-switcher-theme--bulma.vue-switcher-color--red div:after{background-color:#ff3860}.vue-switcher-theme--bulma.vue-switcher-color--red.vue-switcher--unchecked div{background-color:#ffd1da}.vue-switcher-theme--bulma.vue-switcher-color--red.vue-switcher--unchecked div:after{background-color:#ff6b89}.vue-switcher-theme--bulma.vue-switcher-color--yellow div{background-color:#ffe78a}.vue-switcher-theme--bulma.vue-switcher-color--yellow div:after{background-color:#ffdd57}.vue-switcher-theme--bulma.vue-switcher-color--yellow.vue-switcher--unchecked div{background-color:#fffcf0}.vue-switcher-theme--bulma.vue-switcher-color--yellow.vue-switcher--unchecked div:after{background-color:#ffe78a}.vue-switcher-theme--bulma.vue-switcher-color--green div{background-color:#3dde75}.vue-switcher-theme--bulma.vue-switcher-color--green div:after{background-color:#22c65b}.vue-switcher-theme--bulma.vue-switcher-color--green.vue-switcher--unchecked div{background-color:#94edb3}.vue-switcher-theme--bulma.vue-switcher-color--green.vue-switcher--unchecked div:after{background-color:#3dde75}.vue-switcher-theme--bootstrap.vue-switcher-color--default div{background-color:#e6e6e6}.vue-switcher-theme--bootstrap.vue-switcher-color--default div:after{background-color:#f0f0f0}.vue-switcher-theme--bootstrap.vue-switcher-color--default.vue-switcher--unchecked div{background-color:#f5f5f5}.vue-switcher-theme--bootstrap.vue-switcher-color--default.vue-switcher--unchecked div:after{background-color:#f0f0f0}.vue-switcher-theme--bootstrap.vue-switcher-color--primary div{background-color:#4f93ce}.vue-switcher-theme--bootstrap.vue-switcher-color--primary div:after{background-color:#337ab7}.vue-switcher-theme--bootstrap.vue-switcher-color--primary.vue-switcher--unchecked div{background-color:#9fc4e4}.vue-switcher-theme--bootstrap.vue-switcher-color--primary.vue-switcher--unchecked div:after{background-color:#4f93ce}.vue-switcher-theme--bootstrap.vue-switcher-color--success div{background-color:#80c780}.vue-switcher-theme--bootstrap.vue-switcher-color--success div:after{background-color:#5cb85c}.vue-switcher-theme--bootstrap.vue-switcher-color--success.vue-switcher--unchecked div{background-color:#c7e6c7}.vue-switcher-theme--bootstrap.vue-switcher-color--success.vue-switcher--unchecked div:after{background-color:#80c780}.vue-switcher-theme--bootstrap.vue-switcher-color--info div{background-color:#85d0e7}.vue-switcher-theme--bootstrap.vue-switcher-color--info div:after{background-color:#5bc0de}.vue-switcher-theme--bootstrap.vue-switcher-color--info.vue-switcher--unchecked div{background-color:#daf1f8}.vue-switcher-theme--bootstrap.vue-switcher-color--info.vue-switcher--unchecked div:after{background-color:#85d0e7}.vue-switcher-theme--bootstrap.vue-switcher-color--warning div{background-color:#f4c37d}.vue-switcher-theme--bootstrap.vue-switcher-color--warning div:after{background-color:#f0ad4e}.vue-switcher-theme--bootstrap.vue-switcher-color--warning.vue-switcher--unchecked div{background-color:#fceedb}.vue-switcher-theme--bootstrap.vue-switcher-color--warning.vue-switcher--unchecked div:after{background-color:#f4c37d}.vue-switcher-theme--bootstrap.vue-switcher-color--danger div{background-color:#d9534f}.vue-switcher-theme--bootstrap.vue-switcher-color--danger div:after{background-color:#c9302c}.vue-switcher-theme--bootstrap.vue-switcher-color--danger.vue-switcher--unchecked div{background-color:#eba5a3}.vue-switcher-theme--bootstrap.vue-switcher-color--danger.vue-switcher--unchecked div:after{background-color:#d9534f}',""])},120:function(e,t,r){"use strict";var a=r(35);r.n(a).a},121:function(e,t,r){(e.exports=r(7)(!1)).push([e.i,".vue-switcher-theme--custom.vue-switcher-color--orange div{background-color:#ff7c3c}.vue-switcher-theme--custom.vue-switcher-color--orange div:after{background-color:#ef4f00}.vue-switcher-theme--custom.vue-switcher-color--orange.vue-switcher--unchecked div{background-color:#ffc1a2}.vue-switcher-theme--custom.vue-switcher-color--orange.vue-switcher--unchecked div:after{background-color:#ff7c3c}",""])},122:function(e,t,r){"use strict";var a=r(36);r.n(a).a},123:function(e,t,r){(e.exports=r(7)(!1)).push([e.i,"#sensor-mapper[data-v-6bd3250f]{display:flex;margin-top:24px;height:calc(100% - 64px)}#sensor-mapper .row[data-v-6bd3250f]{height:100%}#sensor-mapper #mapper-options[data-v-6bd3250f]{margin-bottom:24px}#sensor-mapper #mapper-options #switches[data-v-6bd3250f]{margin-top:16px}#sensor-mapper #mapper-options .vue-switcher[data-v-6bd3250f]{position:relative;display:inline-block;margin:5px 5px 20px}#sensor-mapper .floor-map[data-v-6bd3250f]{display:flex;align-items:flex-start}#sensor-mapper .floor-map #floor-map[data-v-6bd3250f]{position:relative}",""])},208:function(e,t,r){"use strict";r.r(t);var a=r(1),o=r.n(a),n=r(5),i=r(2),s={name:"switches",props:{typeBold:{default:!1},value:{default:!1},disabled:{default:!1},label:{default:""},textEnabled:{default:""},textDisabled:{default:""},color:{default:"default"},theme:{default:"default"},emitOnMount:{default:!0}},mounted(){this.emitOnMount&&this.$emit("input",this.value)},methods:{trigger(e){this.$emit("input",e.target.checked)}},computed:{classObject(){const{color:e,value:t,theme:r,typeBold:a,disabled:o}=this;return{"vue-switcher":!0,"vue-switcher--unchecked":!t,"vue-switcher--disabled":o,"vue-switcher--bold":a,"vue-switcher--bold--unchecked":a&&!t,["vue-switcher-theme--"+r]:e,["vue-switcher-color--"+e]:e}},shouldShowLabel(){return""!==this.label||""!==this.textEnabled||""!==this.textDisabled}}},c=(r(118),r(3)),l=Object(c.a)(s,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("label",{class:e.classObject},[e.shouldShowLabel?r("span",{staticClass:"vue-switcher__label"},[e.label?r("span",{domProps:{textContent:e._s(e.label)}}):e._e(),e._v(" "),!e.label&&e.value?r("span",{domProps:{textContent:e._s(e.textEnabled)}}):e._e(),e._v(" "),e.label||e.value?e._e():r("span",{domProps:{textContent:e._s(e.textDisabled)}})]):e._e(),e._v(" "),r("input",{attrs:{type:"checkbox",disabled:e.disabled},domProps:{checked:e.value},on:{change:e.trigger}}),e._v(" "),r("div")])}),[],!1,null,null,null).exports,u=r(11),d=r(4);function h(e,t,r,a,o,n,i){try{var s=e[n](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(a,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(a,o){var n=e.apply(t,r);function i(e){h(n,a,o,i,s,"next",e)}function s(e){h(n,a,o,i,s,"throw",e)}i(void 0)}))}}var f="/api/locations",v="/api/floors",g="/api/sensors",m="/api/areas",w={title:"Floor Mapper",props:["bldg_id","bldg_name","floor_id"],components:{Loader:i.e,Modal:i.g,Switches:l},data:function(){return{mapper:null,mapperLoading:!1,loaded:!1,bldg:null,areaTypes:[],floors:[],floorAreas:[],floorSel:null,editMapper:!1,editArea:!1,editSensor:!1,showEntry:!1,showAreaEntry:!1,editMode:!1,entry:{id:null,sensor:"",name:"",group:"",area:null,pos_x:0,pos_y:0,scale:0},areaEntry:{id:null,type:null,name:"",desks:0,seats:0,points:"",scale:0},state:{saving:!1,removing:!1}}},computed:{baseUrl:function(){return Object(n.c)()},floor:function(){var e=this;return this.floorSel?this.floors.find((function(t){return t.hid===e.floorSel})):null},building:function(){return this.bldg_name?this.bldg_name:this.bldg?this.bldg.name:""},areaByDesk:function(){var e=this,t=this.areaTypes.find((function(t){return t.hid===e.areaEntry.type}));return t&&"Workspace Desk Area"===t.name}},watch:{floorSel:function(e,t){var r=this;this.getFloorData(this.floorSel,(function(){r.mapper.setData(r.floor)}))}},methods:{getAreaTypes:function(){var e=this;return p(o.a.mark((function t(){var r,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get("".concat(m,"/types"));case 2:r=t.sent,a=r.data,e.areaTypes=a;case 5:case"end":return t.stop()}}),t)})))()},getBldg:function(e,t){var r=this;return p(o.a.mark((function a(){var n,i;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,axios.get(f,{params:{id:e}});case 2:return n=a.sent,i=n.data,d.a.setBldg(i),r.bldg=i,a.abrupt("return",t&&t());case 7:case"end":return a.stop()}}),a)})))()},getFloors:function(e,t){var r=this;return p(o.a.mark((function a(){var n,i,s;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,axios.get(v,{params:{bid:e}});case 2:return n=a.sent,(i=n.data).forEach((function(e){e.floor_plan_url="".concat(r.baseUrl,"/plans/").concat(e.floor_plan),e.upload_info={uploading:!1,progress:0}})),s=i.sort((function(e,t){return e.floor_no>t.floor_no?1:e.floor_no<t.floor_no?-1:0})),d.a.setFloors(s),r.floors=s,r.floor_id?r.floorSel=r.floor_id:r.floors.length>0&&(r.floorSel=r.floors[0].hid),a.abrupt("return",t&&t());case 10:case"end":return a.stop()}}),a)})))()},getFloorData:function(e,t){var r=this;return p(o.a.mark((function a(){var n,i,s;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,axios.get("".concat(v,"/").concat(e,"/data"));case 2:return n=a.sent,i=n.data,(s=r.floors.find((function(t){return t.hid===e}))).sensors=i.sensors,s.areas=i.areas,r.floorAreas=i.areas,a.abrupt("return",t&&t());case 9:case"end":return a.stop()}}),a)})))()},toggleEditMode:function(e){this.editMapper=e,this.mapper.editMode(e)},toggleAreaMap:function(){this.editArea&&(this.editSensor=!this.editArea),this.mapper.setAreaMapping(this.editArea)},toggleSensorMap:function(){this.editSensor&&(this.editArea=!this.editSensor),this.mapper.setSensorMapping(this.editSensor)},setupMapper:function(){var e=this;e.mapper=new u.a("#floor-map",e.floor,{events:{imgLoad:function(){e.mapperLoading=!0},imgLoaded:function(){e.mapperLoading=!1},sensorAdd:function(t){e.triggerAdd(t.x,t.y,t.scale,t.area)},sensorClick:function(t){e.triggerEdit(t.hid)},sensorMoved:function(e){axios.put("".concat(g,"/coord/").concat(e.hid),{pos_x:e.pos_x,pos_y:e.pos_y,scale:e.scale})},addArea:function(t,r){e.triggerAddArea(t,r)},areaClick:function(t){e.triggerEditArea(t.hid)},areaPtUpdate:function(e,t,r){e&&axios.put("".concat(m,"/coord/").concat(e.hid),{points:t,scale:r})}}})},toggleSaving:function(e){this.state.saving=e},toggleEntry:function(e){var t=this;this.showEntry=e,e&&setTimeout((function(){t.$refs.sensor.focus()}),0)},triggerAdd:function(e,t,r,a){this.entry.id=null,this.entry.sensor="",this.entry.name="",this.entry.group="",this.entry.area=a?a.hid:null,this.entry.pos_x=e,this.entry.pos_y=t,this.entry.scale=r,this.editMode=!1,this.toggleEntry(!0)},addSensor:function(){var e=this;return p(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleSaving(!0),axios.post(g,{floor:e.floor.hid,sensor_id:e.entry.sensor,name:e.entry.name,group:e.entry.group,area:e.entry.area,pos_x:e.entry.pos_x,pos_y:e.entry.pos_y,scale:e.entry.scale}).then((function(t){e.toggleSaving(!1);var r=t.data;r.r&&(e.floor.sensors.push(r.data),e.mapper.drawSensors(),e.toggleEntry(!1))}));case 2:case"end":return t.stop()}}),t)})))()},triggerEdit:function(e){var t=this.floor.sensors.find((function(t){return t.hid===e}));this.entry.id=e,this.entry.sensor=t.sensor_id,this.entry.name=t.name,this.entry.group=t.group_id,this.entry.area=t.aid,this.entry.pos_x=t.pos_x,this.entry.pos_y=t.pos_y,this.entry.scale=t.scale,this.editMode=!0,this.toggleEntry(!0)},upSensor:function(){var e=this;return p(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleSaving(!0),axios.put("".concat(g,"/").concat(e.entry.id),{sensor_id:e.entry.sensor,name:e.entry.name,group:e.entry.group,area:e.entry.area}).then((function(t){if(e.toggleSaving(!1),t.data.r){var r=e.floor.sensors.find((function(t){return t.hid===e.entry.id}));r.sensor_id=e.entry.sensor,r.name=e.entry.name,r.aid=e.entry.area,r.group_id=e.entry.group,e.mapper.drawSensors(),e.toggleEntry(!1)}}));case 2:case"end":return t.stop()}}),t)})))()},delSensor:function(){var e=this;return p(o.a.mark((function t(){var r,a,n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=(r=e).entry.id,n=r.floor.sensors.findIndex((function(e){return e.hid===a})),i=r.floor.sensors[n],r.$duDialog(null,"Remove sensor <strong>".concat(i.sensor_id,"</strong>?"),r.$duDialog.OK_CANCEL,{okText:"Remove",callbacks:{okClick:function(e){this.hide(),r.state.removing=!0,axios.delete("".concat(g,"/").concat(a)).then((function(e){r.state.removing=!1,e.data.r&&(r.floor.sensors.splice(n,1),r.mapper.drawSensors(),r.toggleEntry(!1))}))}}});case 2:case"end":return t.stop()}}),t)})))()},toggleAreaEntry:function(e){var t=this;this.showAreaEntry=e,e?setTimeout((function(){t.$refs.area.focus()}),0):null==this.areaEntry.id&&this.mapper.clearDrawing()},triggerAddArea:function(e,t){this.areaEntry.id=null,this.areaEntry.type=this.areaTypes[0]?this.areaTypes[0].hid:null,this.areaEntry.name="",this.areaEntry.desks=0,this.areaEntry.seats=0,this.areaEntry.points=e,this.areaEntry.scale=t,this.editMode=!1,this.toggleAreaEntry(!0)},addArea:function(){var e=this;return p(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleSaving(!0),axios.post(m,{floor:e.floor.hid,type:e.areaEntry.type,name:e.areaEntry.name,desks:e.areaByDesk?e.areaEntry.desks:null,seats:e.areaByDesk?null:e.areaEntry.seats,points:e.areaEntry.points,scale:e.areaEntry.scale}).then((function(t){e.toggleSaving(!1);var r=t.data;r.r&&(e.floor.areas.push(r.data),e.mapper.drawAreas(),e.toggleAreaEntry(!1))}));case 2:case"end":return t.stop()}}),t)})))()},triggerEditArea:function(e){var t=this.floor.areas.find((function(t){return t.hid===e}));this.areaEntry.id=e,this.areaEntry.type=t.tid,this.areaEntry.name=t.name,this.areaEntry.desks=t.desks,this.areaEntry.seats=t.seats,this.areaEntry.points=t.poly_points.map((function(e){return[e.x,e.y].join(",")})).join(" "),this.areaEntry.scale=t.scale,this.editMode=!0,this.toggleAreaEntry(!0)},upArea:function(){var e=this;return p(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.toggleSaving(!0),axios.put("".concat(m,"/").concat(e.areaEntry.id),{type:e.areaEntry.type,name:e.areaEntry.name,desks:e.areaByDesk?e.areaEntry.desks:null,seats:e.areaByDesk?null:e.areaEntry.seats}).then((function(t){if(e.toggleSaving(!1),t.data.r){var r=e.floor.areas.find((function(t){return t.hid===e.areaEntry.id}));r.tid=e.areaEntry.type,r.name=e.areaEntry.name,r.desks=e.areaEntry.desks,r.seats=e.areaEntry.seats,e.mapper.drawAreas(),e.toggleAreaEntry(!1)}}));case 2:case"end":return t.stop()}}),t)})))()},delArea:function(){var e=this;return p(o.a.mark((function t(){var r,a,n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=(r=e).areaEntry.id,n=r.floor.areas.findIndex((function(e){return e.hid===a})),i=r.floor.areas[n],r.$duDialog(null,"Remove <strong>".concat(i.name,"</strong>? area"),r.$duDialog.OK_CANCEL,{okText:"Remove",callbacks:{okClick:function(e){this.hide(),r.state.removing=!0,axios.delete("".concat(m,"/").concat(a)).then((function(e){r.state.removing=!1,e.data.r&&(r.floor.areas.splice(n,1),r.mapper.drawAreas(),r.toggleAreaEntry(!1))}))}}});case 2:case"end":return t.stop()}}),t)})))()}},created:function(){this.getAreaTypes()},mounted:function(){var e=this,t=d.a.getBldg(),r=d.a.getFloors();if(t&&t.hid===e.bldg_id)if(e.bldg=t,r.length>0){if(e.floors=d.a.getFloors(),e.floor_id?e.floorSel=e.floor_id:e.floors.length>0&&(e.floorSel=e.floors[0].hid),e.loaded=!0,!e.floor)return;e.getFloorData(e.floor.hid,(function(){e.setupMapper()}))}else e.getFloors(e.bldg_id,(function(){e.loaded=!0,e.getFloorData(e.floor.hid,(function(){e.setupMapper()}))}));else e.getBldg(e.bldg_id,(function(){e.getFloors(e.bldg_id,(function(){e.loaded=!0,e.getFloorData(e.floor.hid,(function(){e.setupMapper()}))}))}))}},y=(r(120),r(122),Object(c.a)(w,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[e.loaded?[r("h1",[e._v(e._s(e.building?e.building+" Mapping":"Mapping"))]),e._v(" "),r("transition",{attrs:{name:"fade"}},[e.loaded?r("div",{attrs:{id:"sensor-mapper"}},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-12 col-md-3"},[r("div",{attrs:{id:"mapper-options"}},[r("div",{staticClass:"input-field"},[r("label",[e._v("Floor")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.floorSel,expression:"floorSel"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.floorSel=t.target.multiple?r:r[0]}}},e._l(e.floors,(function(t){return r("option",{key:t.hid,domProps:{value:t.hid}},[e._v(e._s(t.ordinal_no)+" Floor")])})),0)]),e._v(" "),e.editMapper?[r("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.toggleEditMode(!1)}}},[e._v("Close Edit")]),e._v(" "),r("div",{attrs:{id:"switches"}},[r("switches",{attrs:{"type-bold":"true",label:"Area Mapping",theme:"custom",color:"orange","emit-on-mount":"false"},on:{input:e.toggleAreaMap},model:{value:e.editArea,callback:function(t){e.editArea=t},expression:"editArea"}}),e._v(" "),r("switches",{attrs:{"type-bold":"true",label:"Sensor Mapping",theme:"custom",color:"orange","emit-on-mount":"false"},on:{input:e.toggleSensorMap},model:{value:e.editSensor,callback:function(t){e.editSensor=t},expression:"editSensor"}})],1)]:r("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.toggleEditMode(!0)}}},[e._v("Edit Mode")])],2)]),e._v(" "),r("div",{staticClass:"col"},[r("div",{staticClass:"floor-map"},[r("div",{attrs:{id:"floor-map"}},[r("loader",{attrs:{show:e.mapperLoading,type:"spinner"}})],1)])])])]):e._e()])]:e._e(),e._v(" "),r("modal",{attrs:{show:e.showEntry},on:{close:function(t){return e.toggleEntry(!1)}},scopedSlots:e._u([{key:"header",fn:function(){return[r("h2",[e._v(e._s(e.editMode?"Edit":"Add")+" Sensor")])]},proxy:!0},{key:"footer",fn:function(){return[e.editMode?e._e():r("button",{staticClass:"btn btn-primary",attrs:{disabled:e.state.saving},on:{click:e.addSensor}},[e._v(e._s(e.state.saving?"Adding...":"Add"))]),e._v(" "),e.editMode?[r("button",{staticClass:"btn btn-danger btn-link",attrs:{disabled:e.state.removing},on:{click:e.delSensor}},[e._v(e._s(e.state.removing?"Removing...":"Remove"))]),e._v(" "),r("button",{staticClass:"btn btn-primary",attrs:{disabled:e.state.saving},on:{click:e.upSensor}},[e._v(e._s(e.state.saving?"Updating...":"Update"))])]:e._e()]},proxy:!0}])},[e._v(" "),r("div",{attrs:{id:"entry-wrapper"}},[r("div",{staticClass:"input-field"},[r("label",[e._v("Sensor ID")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.entry.sensor,expression:"entry.sensor"}],ref:"sensor",attrs:{type:"text"},domProps:{value:e.entry.sensor},on:{input:function(t){t.target.composing||e.$set(e.entry,"sensor",t.target.value)}}})]),e._v(" "),r("div",{staticClass:"input-field"},[r("label",[e._v("Name")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.entry.name,expression:"entry.name"}],attrs:{type:"text",placeholder:"(Optional)"},domProps:{value:e.entry.name},on:{input:function(t){t.target.composing||e.$set(e.entry,"name",t.target.value)}}})]),e._v(" "),r("div",{staticClass:"input-field"},[r("label",[e._v("Group ID")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.entry.group,expression:"entry.group"}],attrs:{type:"text"},domProps:{value:e.entry.group},on:{input:function(t){t.target.composing||e.$set(e.entry,"group",t.target.value)}}})]),e._v(" "),r("div",{staticClass:"input-field"},[r("label",[e._v("Area")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.entry.area,expression:"entry.area"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.entry,"area",t.target.multiple?r:r[0])}}},e._l(e.floorAreas,(function(t){return r("option",{key:t.hid,domProps:{value:t.hid}},[e._v(e._s(t.name))])})),0)])])]),e._v(" "),r("modal",{attrs:{show:e.showAreaEntry},on:{close:function(t){return e.toggleAreaEntry(!1)}},scopedSlots:e._u([{key:"header",fn:function(){return[r("h2",[e._v(e._s(e.editMode?"Edit":"Add")+" Area")])]},proxy:!0},{key:"footer",fn:function(){return[e.editMode?e._e():r("button",{staticClass:"btn btn-primary",attrs:{disabled:e.state.saving},on:{click:e.addArea}},[e._v(e._s(e.state.saving?"Adding...":"Add"))]),e._v(" "),e.editMode?[r("button",{staticClass:"btn btn-danger btn-link",attrs:{disabled:e.state.removing},on:{click:e.delArea}},[e._v(e._s(e.state.removing?"Removing...":"Remove"))]),e._v(" "),r("button",{staticClass:"btn btn-primary",attrs:{disabled:e.state.saving},on:{click:e.upArea}},[e._v(e._s(e.state.saving?"Updating...":"Update"))])]:e._e()]},proxy:!0}])},[e._v(" "),r("div",{attrs:{id:"entry-wrapper"}},[r("div",{staticClass:"input-field"},[r("label",[e._v("Type")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.areaEntry.type,expression:"areaEntry.type"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.areaEntry,"type",t.target.multiple?r:r[0])}}},e._l(e.areaTypes,(function(t){return r("option",{key:t.hid,domProps:{value:t.hid}},[e._v(e._s(t.name))])})),0)]),e._v(" "),r("div",{staticClass:"input-field"},[r("label",[e._v("Name")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.areaEntry.name,expression:"areaEntry.name"}],ref:"area",attrs:{type:"text"},domProps:{value:e.areaEntry.name},on:{input:function(t){t.target.composing||e.$set(e.areaEntry,"name",t.target.value)}}})]),e._v(" "),e.areaByDesk?r("div",{staticClass:"input-field"},[r("label",[e._v("Desks")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.areaEntry.desks,expression:"areaEntry.desks"}],attrs:{type:"number"},domProps:{value:e.areaEntry.desks},on:{input:function(t){t.target.composing||e.$set(e.areaEntry,"desks",t.target.value)}}})]):r("div",{staticClass:"input-field"},[r("label",[e._v("Seats")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.areaEntry.seats,expression:"areaEntry.seats"}],attrs:{type:"number"},domProps:{value:e.areaEntry.seats},on:{input:function(t){t.target.composing||e.$set(e.areaEntry,"seats",t.target.value)}}})])])]),e._v(" "),r("loader",{attrs:{show:!e.loaded,type:"ripple"}})],2)}),[],!1,null,"6bd3250f",null));t.default=y.exports},34:function(e,t,r){var a=r(119);"string"==typeof a&&(a=[[e.i,a,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(8)(a,o);a.locals&&(e.exports=a.locals)},35:function(e,t,r){var a=r(121);"string"==typeof a&&(a=[[e.i,a,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(8)(a,o);a.locals&&(e.exports=a.locals)},36:function(e,t,r){var a=r(123);"string"==typeof a&&(a=[[e.i,a,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(8)(a,o);a.locals&&(e.exports=a.locals)}}]);