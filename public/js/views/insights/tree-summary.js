(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{109:function(t,e,r){"use strict";r(43)},110:function(t,e,r){(t.exports=r(6)(!1)).push([t.i,"#tree-summary[data-v-5fa7ab40]{margin:24px auto;max-width:100%;width:1024px}",""])},286:function(t,e,r){"use strict";r.r(e);var a=r(1),n=r.n(a),i=r(5),s=r(0),o=r(8),c=r(4),l=r(2);function u(t,e,r){var a=l.y(t),n=l.l(e),i=l.k("$,.2s"),s=10,o=10,c=80,u=l.C().nodeSize([16,150]),d=l.o().x((function(t){return t.y})).y((function(t){return t.x})),p=a.append("svg").attr("viewBox",[-c,-s,900,16]).style("font-size","12px").style("user-select","none"),h=p.append("g").attr("fill","none").attr("stroke","#3DCFA3").attr("stroke-opacity",.4).attr("stroke-width",1.5),m=p.append("g").attr("cursor","pointer").attr("pointer-events","all");return n.x0=75,n.y0=0,n.descendants().forEach((function(t,e){t.id=e,t._children=t.children,t.depth&&7!==t.data.name.length&&(t.children=null)})),function t(e){var a=l.i&&l.i.altKey?2500:250,f=n.descendants().reverse(),g=n.links();u(n);var b=n,v=n;n.eachBefore((function(t){t.x<b.x&&(b=t),t.x>v.x&&(v=t)}));var _=v.x-b.x+s+o,y=p.transition().duration(a).attr("viewBox",[-c,b.x-s,900,_]).tween("resize",window.ResizeObserver?null:function(){return function(){return p.dispatch("toggle")}}),x=m.selectAll("g").data(f,(function(t){return t.id})),w=x.enter().append("g").attr("data-id",(function(t){return t.id})).attr("transform",(function(t){return"translate(".concat(e.y0,",").concat(e.x0,")")})).attr("fill-opacity",0).attr("stroke-opacity",0).on("click",(function(e){e.children=e.children?null:e._children,t(e)}));w.append("circle").attr("r",2.5).attr("fill",(function(t){return t._children,"#3DCFA3"})).attr("stroke-width",10),w.append("text").attr("dy","0.31em").attr("x",(function(t){return t._children?-6:6})).attr("text-anchor",(function(t){return t._children?"end":"start"})).attr("fill","#fff").text((function(t){return"".concat(t.data.name," ").concat(t.data.number?" - ".concat(t.data.value):r?i(t.data.value||0):"".concat(Math.round(t.data.value),"%"))})).clone(!0).lower().attr("stroke-linejoin","round").attr("stroke-width",3).attr("stroke","#2B2B2B"),x.merge(w).transition(y).attr("transform",(function(t){return"translate(".concat(t.y,",").concat(t.x,")")})).attr("fill-opacity",1).attr("stroke-opacity",1),x.exit().transition(y).remove().attr("transform",(function(t){return"translate(".concat(e.y,",").concat(e.x,")")})).attr("fill-opacity",0).attr("stroke-opacity",0);var F=h.selectAll("path").data(g,(function(t){return t.target.id})),k=F.enter().append("path").attr("d",(function(t){var r={x:e.x0,y:e.y0};return d({source:r,target:r})}));F.merge(k).transition(y).attr("d",(function(t){var e=t.target._children&&t.target._children.length>0,r=m.select('[data-id="'.concat(t.target.id,'"]')).node().getBBox(),a={x:t.target.x,y:t.target.y-r.width};return d(e?{source:t.source,target:a}:{source:t.source,target:t.target})})),F.exit().transition(y).remove().attr("d",(function(t){var r={x:e.x,y:e.y};return d({source:r,target:r})})),n.eachBefore((function(t){t.x0=t.x,t.y0=t.y}))}(n),p.node()}function d(t,e,r,a,n,i,s){try{var o=t[i](s),c=o.value}catch(t){return void r(t)}o.done?e(c):Promise.resolve(c).then(a,n)}function p(t){return function(){var e=this,r=arguments;return new Promise((function(a,n){var i=t.apply(e,r);function s(t){d(i,a,n,s,o,"next",t)}function o(t){d(i,a,n,s,o,"throw",t)}s(void 0)}))}}function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var g={props:["data_filter"],components:{CaretIcon:o.a,CaretLeftIcon:o.b,Checkbox:c.a,DateRangeToggle:c.c,FilterDropdown:c.d,Loader:c.f,TimeSlider:c.i},title:"Summary",data:function(){return{filters:[{value:"opportunity_cost",label:"Cost of Unused Spaces",boxLabel:"Opportunity Cost",btnLabel:"Cost Analysis"},{value:"workspace_utils.max_percentage",label:"Peak Usage",boxLabel:"Peak Workspace Utilisation",btnLabel:"Peak Usage"},{value:"workspace_utils.average_percentage",label:"Average Usage",boxLabel:"Average Workspace Utilisation",btnLabel:"Average Usage"},{value:"low_perform_workspace.average_percentage",label:"Low Performing Spaces",boxLabel:"Low Performing Spaces",btnLabel:"Low Performing Spaces"},{value:"free_workspace_utils.average_percentage",label:"Spare Capacity",boxLabel:"Spare Capacity",btnLabel:"Spare Capacity"}],loaded:!1,showPageOpts:!1,showEmbed:!1,timeFilter:{start:null,end:null},minuteFilterLbl:"60 minutes",showMinuteFilter:!1,axiosSrc:null,dataError:null,dataFilters:{trigger:6,start_hour:8,stop_hour:16,start_date:"",stop_date:"",node_type:"Customer",node_id:"ad9b565d-9082-4808-99cd-32f2f09f63f2"}}},computed:m(m(m({},Object(i.e)({user:function(t){return t.user},company:function(t){return t.user.company},summary:function(t){return t.homepage.summary},rangeFilter:function(t){return t.homepage.rangeFilter},startTimeFilter:function(t){return t.homepage.startTime},endTimeFilter:function(t){return t.homepage.endTime}})),Object(i.c)({api_header:"backend/api_header",api_customer_summary:"backend/api_customer_summary"})),{},{settings:function(){return this.user.company?this.user.company.settings:null},baseUrl:function(){return Object(s.g)()},minuteFilters:function(){return[60].map((function(t){return{value:t,label:"".concat(t," minutes")}}))},dataFilter:function(){var t=this;return this.filters.find((function(e){return e.value==(t.data_filter||"opportunity_cost")}))},statDateRange:function(){var t=this.dataFilters.start_date,e=this.dataFilters.stop_date,r=new Date(t.substring(0,t.indexOf("T"))),a=new Date(e.substring(0,e.indexOf("T")));return Object(s.d)(r,a)}}),methods:m(m({},Object(i.d)({setSummary:"homepage/setSummary",setRange:"homepage/setRange",setTime:"homepage/setTime"})),{},{backTo:function(){this.$router.back()},rangeSelect:function(t,e,r){var a=Object(s.w)(e),n=Object(s.v)(r);console.log("rangeSelect",t,a,n),this.setRange({type:t,start:a,end:n}),this.dataFilters.start_date=a,this.dataFilters.stop_date=n,this.axiosSrc&&this.axiosSrc.cancel("Date range selected"),Object(s.c)("#tree-summary"),this.renderTree(!0)},toggleEmbed:function(t){t&&(this.showPageOpts=!1),this.showEmbed=t},renderTree:function(){var t=arguments,e=this;return p(n.a.mark((function r(){var a,i,o,c,l,d,p,h,m,g;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],i=["building_country","building_city"],c={_:o=[]},l=e.dataFilter.value,d="opportunity_cost"==l,e.loaded=!1,null!=e.summary&&!a){r.next=23;break}return e.axiosSrc=axios.CancelToken.source(),r.next=7,axios.post(e.api_customer_summary,e.dataFilters,e.api_header(e.axiosSrc.token));case 7:if(p=r.sent,(h=p.data).building_summary){r.next=15;break}return e.dataError=h,e.loaded=!0,r.abrupt("return");case 15:if(!h.building_summary||0!=h.building_summary.length){r.next=21;break}return e.dataError="No results",e.loaded=!0,r.abrupt("return");case 21:e.dataError=null,e.setSummary(h);case 23:m={ID:"",name:e.summary.customer,children:[]},g=JSON.parse(JSON.stringify(e.summary.building_summary)),m.value=(d?s.t:s.b)(g.map((function(t){return Object(s.k)(t,l)}))),g.forEach((function(t){t.name=t.building_name,t.value=Object(s.k)(t,l),t.children=[{name:"Free Desks at Peak",value:t.free_workspace_utils.max,number:!0},{name:"Free Meeting Rooms at Peak",value:t.free_meeting_room_occupancy.max,number:!0}],i.reduce((function(e,r){if(!e[t[r]]&&(e[t[r]]={_:[]},t[r])){var a,n=(f(a={},"name",t[r]),f(a,"children",e[t[r]]._),a);if("building_country"===r){var i=g.filter((function(e){return e[r]==t[r]}));n.value=(d?s.t:s.b)(i.map((function(t){return Object(s.k)(t,l)}))),n.building_country=!0}else if("building_city"===r){var o=g.filter((function(e){return e[r]==t[r]}));n.value=(d?s.t:s.b)(o.map((function(t){return Object(s.k)(t,l)}))),n.building_city=!0}e._.push(n)}return e[t[r]]}),c)._.push(t)})),m.children=o,e.loaded=!0,setTimeout((function(){u("#tree-summary",m,d)}),100);case 30:case"end":return r.stop()}}),r)})))()},timeStartChange:function(t,e){this.dataFilters.start_hour=e,this.setTime({start:e,end:this.dataFilters.stop_hour}),this.axiosSrc&&this.axiosSrc.cancel("Start time updated"),Object(s.c)("#tree-summary"),this.renderTree(!0)},timeEndChange:function(t,e){this.dataFilters.stop_hour=e,this.setTime({start:this.dataFilters.start_hour,end:e}),this.axiosSrc&&this.axiosSrc.cancel("End time updated"),Object(s.c)("#tree-summary"),this.renderTree(!0)},filterMinute:function(t){var e=this.minuteFilters.find((function(e){return e.value==t}));this.showMinuteFilter=!1,this.minuteFilterLbl=e.label}}),created:function(){if(this.company&&this.company.ref_id&&(this.dataFilters.node_id=this.company.ref_id),null==this.rangeFilter.type){var t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23),a=Object(s.w)(e),n=Object(s.v)(r);this.dataFilters.start_date=a,this.dataFilters.stop_date=n,this.setRange({type:"today",start:a,end:n}),console.log("setRange","today",a,n)}else this.dataFilters.start_date=this.rangeFilter.start,this.dataFilters.stop_date=this.rangeFilter.end;this.startTimeFilter?(this.dataFilters.start_hour=this.timeFilter.start=this.startTimeFilter,this.dataFilters.stop_hour=this.timeFilter.end=this.endTimeFilter):this.settings&&(this.dataFilters.start_hour=this.timeFilter.start=Object(s.u)(this.settings.start_time),this.dataFilters.stop_hour=this.timeFilter.end=Object(s.u)(this.settings.end_time))},mounted:function(){this.renderTree()}},b=(r(109),r(3)),v=Object(b.a)(g,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[r("div",{staticClass:"graph-header"},[r("div",{staticClass:"page-back"},[r("div",{staticClass:"back-button",on:{click:t.backTo}},[r("button",{staticClass:"btn btn-primary btn-small"},[r("caret-left-icon")],1),t._v("\n                Back\n            ")])]),t._v(" "),r("span",{staticClass:"page-opt-trigger",attrs:{role:"button"},on:{click:function(e){t.showPageOpts=!t.showPageOpts}}},[r("span",{staticClass:"dot"}),t._v(" "),r("span",{staticClass:"dot"}),t._v(" "),r("span",{staticClass:"dot"})]),t._v(" "),r("transition",{attrs:{name:"fadeUp"}},[t.showPageOpts?r("div",{staticClass:"page-opt-panel"},[r("ul",[r("li",[r("a",{on:{click:function(e){return t.toggleEmbed(!0)}}},[t._v("Embed")])])])]):t._e()])],1),t._v(" "),r("div",{staticClass:"graph-content"},[r("div",{staticClass:"chart-header"},[r("span",{staticClass:"chart-title"},[t._v(t._s(t.dataFilter.btnLabel))]),t._v(" "),r("span",{staticClass:"chart-subtitle"},[t._v(t._s(t.statDateRange))])]),t._v(" "),r("date-range-toggle",{attrs:{active:t.rangeFilter},on:{select:t.rangeSelect}}),t._v(" "),t.loaded?[t.dataError?r("div",{staticClass:"error-display",staticStyle:{height:"40vh"}},[r("p",[t._v(t._s(t.dataError))]),t._v(" "),r("a",{staticClass:"btn btn-primary",staticStyle:{"align-self":"center"},attrs:{href:"javascript:;"},on:{click:function(e){return t.renderTree(!0)}}},[t._v("Retry")])]):r("div",{attrs:{id:"tree-summary"}})]:r("div",{staticStyle:{height:"40vh"}},[r("loader",{attrs:{show:!t.loaded,type:"ripple"}})],1),t._v(" "),r("div",{staticClass:"bottom-filters"},[r("time-slider",{attrs:{from:t.timeFilter.start,to:t.timeFilter.end},on:{startChanged:t.timeStartChange,endChanged:t.timeEndChange}}),t._v(" "),r("span",{staticClass:"graph-filter",on:{click:function(e){t.showMinuteFilter=!t.showMinuteFilter}}},[t._v("\n                "+t._s(t.minuteFilterLbl?t.minuteFilterLbl:"Select")+"\n                "),r("span",{staticClass:"caret"},[r("caret-icon")],1),t._v(" "),r("filter-dropdown",{attrs:{filters:t.minuteFilters,position:"top",show:t.showMinuteFilter},on:{onSelect:t.filterMinute}})],1)],1)],2),t._v(" "),r("div",{staticClass:"graph-footer"},[r("div",{staticClass:"left-options"}),t._v(" "),r("div",{staticClass:"right-options"},[r("checkbox",{attrs:{label:"Save to report"}})],1)])])}),[],!1,null,"5fa7ab40",null);e.default=v.exports},43:function(t,e,r){var a=r(110);"string"==typeof a&&(a=[[t.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};r(7)(a,n);a.locals&&(t.exports=a.locals)}}]);