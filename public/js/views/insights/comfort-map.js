(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{106:function(t,e,n){"use strict";var a=n(27);n.n(a).a},107:function(t,e,n){(t.exports=n(7)(!1)).push([t.i,'.graph-content .range-toggle[data-v-11fb69c9] {\n  flex: 0;\n  padding-bottom: 24px;\n}\n#live-view[data-v-11fb69c9] {\n  flex: 1 auto;\n  display: flex;\n  flex-direction: column;\n}\n#live-view #comfort-map[data-v-11fb69c9] {\n  flex: 1 auto;\n  display: flex;\n  justify-content: center;\n}\n#live-view #comfort-map #temp-legend[data-v-11fb69c9] {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  text-align: left;\n  margin-left: 64px;\n}\n#live-view #comfort-map #temp-legend .legend[data-v-11fb69c9] {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n}\n#live-view #comfort-map #temp-legend .legend .dot[data-v-11fb69c9] {\n  position: relative;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  margin-right: 12px;\n}\n#live-view #comfort-map #temp-legend .legend .dot[data-v-11fb69c9]::before {\n  content: "";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 18px;\n  height: 18px;\n  border-radius: 50%;\n  transform: translate(-50%, -50%);\n}\n#live-view #comfort-map #temp-legend .legend .dot.orange[data-v-11fb69c9] {\n  background-color: #FF8600;\n}\n#live-view #comfort-map #temp-legend .legend .dot.orange[data-v-11fb69c9]::before {\n  background-color: rgba(255, 134, 0, 0.3);\n}\n#live-view #comfort-map #temp-legend .legend .dot.green[data-v-11fb69c9] {\n  background-color: #01FE01;\n}\n#live-view #comfort-map #temp-legend .legend .dot.green[data-v-11fb69c9]::before {\n  background-color: rgba(1, 254, 1, 0.3);\n}\n#live-view #comfort-map #temp-legend .legend .dot.blue[data-v-11fb69c9] {\n  background-color: #0998ff;\n}\n#live-view #comfort-map #temp-legend .legend .dot.blue[data-v-11fb69c9]::before {\n  background-color: rgba(9, 152, 255, 0.3);\n}',""])},11:function(t,e,n){"use strict";var a=n(0),r=n(5);e.a=function(t,e,n){var o=this,i=a.z(t),s=function(){return i.node().parentNode.getBoundingClientRect().width||800},l=function(){return i.node().parentNode.getBoundingClientRect().height||300},c=800,d=300,f=e,p=f.sensors||[],u=f.areas||[],g=Object(r.b)({edit:!1,heatmap:!1,comfortmap:!1},n),h={x:0,y:0,scale:0},m={sensorMapping:!1,showSensors:!1,areaMapping:!1,showAreas:!1,drawing:!1,polyMoved:!1},v=[],y=a.x().domain([0,50]).range([0,c]),_=a.x().domain([0,33.79]).range([0,d]),x=this,w=a.y().domain([0,1,2]).range(["#01FE01","#FF8600","#ED0003"]),b=a.y().domain([0,1,2]).range(["rgba(1,254,1,0.3)","rgba(255,134,0,0.3)","rgba(237,0,3,0.3)"]);i.selectAll("svg").remove(),i.selectAll(".tooltip").remove();var F=i.append("div").attr("class","tooltip"),C=i.append("svg").attr("width",c).attr("height",d).style("display","block").style("background","#ffffff").on("click",(function(){if(g.edit){var t=a.i,e=document.elementFromPoint(t.x,t.y);if("svg"!==e.tagName){var n=k.__transform,r=n?(t.offsetX-n.x)/n.k:t.offsetX,o=n?(t.offsetY-n.y)/n.k:t.offsetY;if((n&&1===n.z||!n)&&(r-=h.x,o-=h.y),m.sensorMapping){var i="polygon"===e.tagName?a.z(e.parentNode).data()[0]:null;return g.events&&g.events.sensorAdd&&g.events.sensorAdd.call(x,{x:r,y:o,scale:h.scale,area:i})}if(m.areaMapping){var s={x:n?(t.offsetX-n.x)/n.k:t.offsetX,y:n?(t.offsetY-n.y)/n.k:t.offsetY},l=A.select("g.area-draw");l.empty()?function(t){m.drawing=!0,N(A.append("g").attr("class","area-draw"),t)}(s):N(l,s)}}}}));(g.heatmap||g.comfortmap)&&C.append("defs").append("filter").attr("id","blur").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%").append("feGaussianBlur").attr("stdDeviation",g.heatmap?7:15);var k=C.selectAll(".map-layer").data([0]).enter().append("g").attr("class","map-layer"),M=k.append("g").attr("class","image-layer"),A=k.append("g").attr("class","area-layer"),B=k.append("g").attr("class","sensor-layer"),E=a.E().scaleExtent([1,8]).on("zoom",(function(){k.__transform=a.i.transform;var t=(1-k.__transform.k)*(y.range()[1]-y.range()[0]),e=(1-k.__transform.k)*(_.range()[1]-_.range()[0]);k.__transform.x=Math.min(y.range()[0],Math.max(k.__transform.x,t)),k.__transform.y=Math.min(_.range()[0],Math.max(k.__transform.y,e)),M.attr("transform",k.__transform),B.attr("transform",k.__transform),A.attr("transform",k.__transform)}));function z(t,e){var n=new Image;n.src=t,n.onload=function(){var t,r,o={h:l()-n.height,w:s()-n.width},i=o.h<0&&o.w<0,f=!i&&o.h<o.w||i&&o.h>o.w?l()/n.height:s()/n.width,p=Math.min(Math.min(n.width*f,n.width),s()),u=Math.min(Math.min(n.height*f,n.height),l());return console.log("getImageDim",n.width,n.height,o,f,p,u,s(),l()),c=t=p,d=r=u,y=a.x().domain([0,50]).range([0,t]),_=a.x().domain([0,33.79]).range([0,r]),C.attr("width",t).attr("height",r),e&&e({height:n.height,width:n.width})}}function D(t){z(f.floor_plan_url,(function(e){var n=d-e.height<c-e.width?d/e.height:c/e.width,a=e.width*n,r=e.height*n,o=(c-a)/2,i=(d-r)/2;h.x=o<0?0:o,h.y=i<0?0:i,h.scale=n,t&&t()}))}function P(t,e,n){n&&F.html(n),F.style("left","".concat(t,"px")).style("top","".concat(e,"px"))}function N(t,e){v.push(e),t.select("polyline").remove(),t.insert("polyline",":first-child").data(v).attr("points",(function(){return v.map((function(t){return[t.x,t.y].join(",")})).join(" ")})).style("fill","none").attr("stroke","#53DBF3"),t.append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",4).attr("fill","#FFEB3B").attr("stroke","#53DBF3").style("cursor","pointer").on("click",(function(){return function(){A.select("g.area-draw").remove();var t=(e=v,h.scale,e.map((function(t){return[t.x-h.x,t.y-h.y].join(",")})).join(" "));var e;return X(v),v.splice(0),m.drawing=!1,g.events&&g.events.addArea&&g.events.addArea.call(x,t,h.scale)}()}))}function S(t,e){return t.map((function(t){var n=parseFloat(h.scale.toFixed(12));return[t.x/e*n+h.x,t.y/e*n+h.y].join(",")})).join(" ")}function j(t){return t.map((function(t){return[t.x,t.y].join(",")})).join(" ")}function X(t,e){var n=A.append("g").attr("class",e?"area":"area unsaved"),r=g.edit&&m.areaMapping;n.append("polygon").attr("points",e?S(t,e.scale):j(t)).style("fill","#53DBF3").style("opacity",.2).style("cursor",(function(){return r?"move":m.sensorMapping?"crosshair":"default"})).on("click",(function(t){return r&&(function(t){g.events&&g.events.areaClick&&g.events.areaClick.call(x,t)}(e),a.i.stopPropagation())})).on("mouseover",(function(t){m.sensorMapping||(F.transition().duration(200).style("opacity",.9),P(a.i.offsetX+15,a.i.offsetY-F.node().getBoundingClientRect().height/2,e.name))})).on("mousemove",(function(){m.polyMoved||m.sensorMapping||P(a.i.offsetX+15,a.i.offsetY-F.node().getBoundingClientRect().height/2)})).on("mouseout",(function(){F.transition().duration(200).style("opacity",0)})).call(a.h().on("drag",Y).on("end",O));e&&n.data([e]),r&&n.selectAll("circles").data(t).enter().append("circle").attr("cx",(function(t){return e?t.x/e.scale*parseFloat(h.scale.toFixed(12))+h.x:t.x})).attr("cy",(function(t){return e?t.y/e.scale*parseFloat(h.scale.toFixed(12))+h.y:t.y})).attr("r",4).attr("fill","#FFEB3B").attr("stroke","#53DBF3").style("cursor","move").call(a.h().on("drag",U).on("end",R))}function Y(){if(g.edit&&m.areaMapping){var t,e=a.i,n=e.dx,r=e.dy,o=a.z(this),i=a.z(this.parentNode).selectAll("circle"),s=[],l=a.z(this.parentNode).data()[0];m.polyMoved=0!==n||0!==r,i.each((function(e){t=a.z(this),e.x+=n,e.y+=r,t.attr("cx",(function(t){return l?e.x/l.scale*parseFloat(h.scale.toFixed(12))+h.x:e.x})).attr("cy",(function(t){return l?e.y/l.scale*parseFloat(h.scale.toFixed(12))+h.y:e.y})),s.push({x:e.x,y:e.y})})),o.attr("points",S(s,l.scale))}}function O(){if(g.edit&&m.areaMapping){var t=a.z(this.parentNode).data()[0],e=a.z(this.parentNode).selectAll("circle"),n=[];if(!m.polyMoved)return;m.polyMoved=!1,e.each((function(t){return n.push({x:t.x,y:t.y})}));var r=j(n);return g.events&&g.events.areaPtUpdate&&g.events.areaPtUpdate.call(x,0===t?null:t,r,h.scale)}}function U(t){t.dragged=!0;var e=a.i,n=a.z(this),r=[],o=a.z(this.parentNode).select("polygon"),i=a.z(this.parentNode).selectAll("circle"),s=a.z(this.parentNode).data()[0];n.attr("cx",e.x+h.x).attr("cy",e.y+h.y),t.x+=e.dx,t.y+=e.dy,i.each((function(t){return r.push({x:t.x,y:t.y})})),o.attr("points",S(r,s.scale))}function R(t){if(t.dragged){t.dragged=!1;var e=[],n=a.z(this.parentNode).selectAll("circle"),r=a.z(this.parentNode).data()[0];n.each((function(t){return e.push({x:t.x,y:t.y})}));var o=j(e);return g.events&&g.events.areaPtUpdate&&g.events.areaPtUpdate.call(x,0===r?null:r,o,h.scale)}}function I(t){g.edit&&m.sensorMapping&&(t.dragged=!0,a.z(this).attr("cx",t.pos_x=a.i.x).attr("cy",t.pos_y=a.i.y))}function L(t){if(g.edit&&m.sensorMapping&&t.dragged)return t.dragged=!1,t.pos_x-=h.x,t.pos_y-=h.y,t.scale=h.scale,g.events&&g.events.sensorMoved&&g.events.sensorMoved.call(x,t)}return k.call(E).on("mousemove",(function(){if(m.drawing){var t=A.select("g.area-draw");t.select("line").remove();var e=v[v.length-1],n=a.i,r=k.__transform,o=r?(n.offsetX-r.x)/r.k:n.offsetX,i=r?(n.offsetY-r.y)/r.k:n.offsetY;t.insert("line",":nth-child(2)").attr("x1",e.x).attr("y1",e.y).attr("x2",o).attr("y2",i).attr("stroke","#53DBF3").attr("stroke-width",1).style("pointer-events","none")}})),this.drawFloorPlan=function(){if(M.selectAll("image").remove(),k.__transform&&M.attr("transform",k.__transform),f.floor_plan){var t=g.edit&&(m.sensorMapping||m.areaMapping);M.insert("image",":first-child").attr("xlink:href",f.floor_plan_url).attr("height",_(33.79)-_(0)).attr("width",y(50)-y(0)).style("cursor",(function(){return t?"crosshair":"default"}))}},this.drawSensors=function(){if(B.selectAll(".sensor").remove(),k.__transform&&B.attr("transform",k.__transform),0!==p.length){var t=g.edit&&m.sensorMapping;B.selectAll(".sensor").data(p).enter().append("circle").attr("class","sensor").attr("data-id",(function(t){return t.hid})).attr("r",g.heatmap?15:g.comfortmap?35:5).attr("stroke-width",g.heatmap||g.comfortmap?null:5).attr("stroke",g.heatmap||g.comfortmap?null:b(0)).style("fill",w(0)).attr("filter",g.heatmap||g.comfortmap?"url(#blur)":null).style("cursor",(function(){return t?"move":"default"})).attr("cx",(function(t){var e=parseFloat(h.scale.toFixed(12));return t.pos_x/t.scale*e+h.x})).attr("cy",(function(t){var e=parseFloat(h.scale.toFixed(12));return t.pos_y/t.scale*e+h.y})).on("mouseover",(function(){if(!g.comfortmap){var t=a.z(this),e=p.find((function(e){return e.hid===t.attr("data-id")}));F.transition().duration(200).style("opacity",.95),P(a.i.offsetX+15,a.i.offsetY-F.node().getBoundingClientRect().height/2,"<div>ID: ".concat(e.sensor_id,"</div><div>Name: ").concat(e.name?e.name:"(None)","</div>"))}})).on("mousemove",(function(){g.comfortmap||P(a.i.offsetX+15,a.i.offsetY-F.node().getBoundingClientRect().height/2)})).on("mouseout",(function(){g.comfortmap||F.transition().duration(200).style("opacity",0)})).on("click",(function(e){return t&&(function(t){g.events&&g.events.sensorClick&&g.events.sensorClick.call(x,t)}(e),a.i.stopPropagation())})).call(a.h().on("drag",I).on("end",L))}},this.setSensorColor=function(t,e){var n="occupied"===e?1:0;B.select('.sensor[data-id="'.concat(t,'"]')).style("fill",w(n)).attr("stroke",b(n))},this.drawAreas=function(){A.selectAll("g.area").remove(),k.__transform&&A.attr("transform",k.__transform),0!==u.length&&u.forEach((function(t){return X(t.poly_points,t)}))},this.setData=function(t){p=(f=t).sensors,u=f.areas,k.__transform=null,this.redraw(!0)},this.redraw=function(t){var e=this;t&&(k.__transform=null,k.call(E.transform,a.F)),this.clearDrawing(),D((function(){e.drawFloorPlan(),e.drawAreas(),e.drawSensors()}))},this.editMode=function(t){g.edit=t,this.redraw(!1)},this.setAreaMapping=function(t){t&&(m.sensorMapping=!1),m.areaMapping=t,this.redraw(!1)},this.clearDrawing=function(){m.drawing=!1,v.splice(0),A.select("g.area-draw").remove(),A.select("g.area.unsaved").remove()},this.setSensorMapping=function(t){t&&(m.areaMapping=!1),m.sensorMapping=t,this.redraw(!1)},f&&D((function(){o.drawFloorPlan(),o.drawAreas(),o.drawSensors()})),this}},211:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n.n(a),o=n(4),i=n(5),s=n(6),l=n(2),c=n(11);function d(t,e,n,a,r,o,i){try{var s=t[o](i),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(a,r)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(a,r){var o=t.apply(e,n);function i(t){d(o,a,r,i,s,"next",t)}function s(t){d(o,a,r,i,s,"throw",t)}i(void 0)}))}}var p="/api/locations",u="/api/floors",g={title:"Comfort Map",props:["bldg_id","floor_id"],components:{CaretIcon:s.a,CaretLeftIcon:s.b,Checkbox:l.a,DateRangeToggle:l.c,FilterDropdown:l.d,Loader:l.e,TimeSlider:l.h},data:function(){return{loaded:!1,user:null,showPageOpts:!1,showEmbed:!1,showFilter:!1,building:null,floors:[],floor:null,floorFilter:null,mapper:null,timeFilter:{start:null,end:null}}},computed:{settings:function(){return this.user.company?this.user.company.settings:null},baseUrl:function(){return Object(i.c)()},floorFilters:function(){return this.floors.map((function(t){return{value:t.hid,label:"".concat(t.ordinal_no," Floor")}}))}},methods:{backTo:function(){this.$router.back()},filterSelect:function(t,e){var n=this;this.showFilter=!1,this.floor=this.floors.find((function(e){return e.hid===t})),this.floorFilter=e,this.getFloorData(t,(function(){n.mapper.setData(n.floor)}))},toLive:function(){this.$router.push({name:"live",query:{bid:this.bldg_id,fid:this.floor.hid}})},rangeSelect:function(t,e,n){},timeStartChange:function(t){this.timeFilter.start=t},timeEndChange:function(t){this.timeFilter.end=t},toggleEmbed:function(t){t&&(this.showPageOpts=!1),this.showEmbed=t},getBuilding:function(t){var e=this;return f(r.a.mark((function n(){var a,o;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,axios.get(p,{params:{id:t}});case 2:a=n.sent,o=a.data,e.building=o,e.getFloors(t,(function(){var t=e.floor_id?e.floor_id:e.floors[0].hid;e.floor=e.floors.find((function(e){return e.hid===t})),e.floorFilter="".concat(e.floor.ordinal_no," Floor"),e.getFloorData(t,(function(){e.loaded=!0,setTimeout((function(){e.setFloorMap()}),0)}))}));case 6:case"end":return n.stop()}}),n)})))()},getFloors:function(t,e){var n=this;return f(r.a.mark((function a(){var o,i,s;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,axios.get(u,{params:{bid:t}});case 2:return o=a.sent,(i=o.data).forEach((function(t){t.floor_plan_url="".concat(n.baseUrl,"/plans/").concat(t.floor_plan)})),s=i.sort((function(t,e){return t.floor_no>e.floor_no?1:t.floor_no<e.floor_no?-1:0})),n.floors=s,a.abrupt("return",e&&e());case 8:case"end":return a.stop()}}),a)})))()},getFloorData:function(t,e){var n=this;return f(r.a.mark((function a(){var o,i;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,axios.get("".concat(u,"/").concat(t,"/data"),{params:{so:!0}});case 2:return o=a.sent,(i=o.data).sensors.forEach((function(t){t.sensor_state="available"})),n.floor.sensors=i.sensors,n.floor.areas=[],a.abrupt("return",e&&e());case 8:case"end":return a.stop()}}),a)})))()},setFloorMap:function(){this.mapper=new c.a("#floor-map",this.floor,{comfortmap:!0})}},created:function(){this.user=o.a.getUser()},mounted:function(){this.bldg_id&&this.getBuilding(this.bldg_id)}},h=(n(106),n(3)),m=Object(h.a)(g,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t.loaded?n("div",{staticClass:"graph-wrapper"},[n("div",{staticClass:"graph-header"},[n("div",{staticClass:"page-back"},[n("div",{staticClass:"back-button",on:{click:t.backTo}},[n("button",{staticClass:"btn btn-primary btn-small"},[n("caret-left-icon")],1),t._v("\n                    Back\n                ")])]),t._v(" "),n("div",{staticClass:"graph-filters"},[n("span",{staticClass:"graph-filter",on:{click:function(e){t.showFilter=!t.showFilter}}},[t._v("\n                        "+t._s(t.floorFilter?t.floorFilter:"Select Floor")+"\n                        "),n("span",{staticClass:"caret"},[n("caret-icon")],1),t._v(" "),n("filter-dropdown",{attrs:{filters:t.floorFilters,show:t.showFilter},on:{onSelect:t.filterSelect}})],1),t._v(" "),n("a",{staticClass:"btn btn-primary ml-12",attrs:{href:"javascript:;"},on:{click:t.toLive}},[t._v("Live")])]),t._v(" "),n("span",{staticClass:"page-opt-trigger",attrs:{role:"button"},on:{click:function(e){t.showPageOpts=!t.showPageOpts}}},[n("span",{staticClass:"dot"}),t._v(" "),n("span",{staticClass:"dot"}),t._v(" "),n("span",{staticClass:"dot"})]),t._v(" "),n("transition",{attrs:{name:"fadeUp"}},[t.showPageOpts?n("div",{staticClass:"page-opt-panel"},[n("ul",[n("li",[n("a",{on:{click:function(e){return t.toggleEmbed(!0)}}},[t._v("Embed")])])])]):t._e()])],1),t._v(" "),n("div",{staticClass:"graph-content"},[n("div",{staticClass:"chart-header"},[n("span",{staticClass:"chart-title"},[t._v(t._s(t.floor.ordinal_no+" Floor")+" Comfort Map")]),t._v(" "),n("span",{staticClass:"chart-subtitle"},[t._v(t._s(t.building.name))])]),t._v(" "),n("date-range-toggle",{on:{select:t.rangeSelect}}),t._v(" "),t._m(0),t._v(" "),n("time-slider",{attrs:{from:t.settings?t.settings.start_time:null,to:t.settings?t.settings.end_time:null},on:{startChanged:t.timeStartChange,endChanged:t.timeEndChange}}),t._v(" "),n("div",{staticClass:"clearfix"})],1),t._v(" "),n("div",{staticClass:"graph-footer"},[n("div",{staticClass:"left-options"}),t._v(" "),n("div",{staticClass:"right-options"},[n("checkbox",{attrs:{label:"Save to report"}})],1)])]):t._e(),t._v(" "),n("loader",{attrs:{show:!t.loaded,type:"ripple"}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"live-view"}},[e("div",{attrs:{id:"comfort-map"}},[e("div",{staticClass:"floor-map",attrs:{id:"floor-map"}}),this._v(" "),e("div",{attrs:{id:"temp-legend"}},[e("div",{staticClass:"legend"},[e("span",{staticClass:"dot orange"}),this._v("More than 24°c\n                        ")]),this._v(" "),e("div",{staticClass:"legend"},[e("span",{staticClass:"dot green"}),this._v("22°c - 24°c\n                        ")]),this._v(" "),e("div",{staticClass:"legend"},[e("span",{staticClass:"dot blue"}),this._v("Less than 21°c\n                        ")])])])])}],!1,null,"11fb69c9",null);e.default=m.exports},27:function(t,e,n){var a=n(107);"string"==typeof a&&(a=[[t.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(8)(a,r);a.locals&&(t.exports=a.locals)}}]);