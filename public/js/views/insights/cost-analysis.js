(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{246:function(t,e,r){"use strict";r.r(e);var n=r(0),a=r.n(n),i=r(5),o=r(4),s=r(6),c=r(2),u=r(1);function l(t,e){var r=u.y(t),n=u.l(e),a=u.k("$,.2s"),i=10,o=10,s=80,c=u.B().nodeSize([16,150]),l=u.o().x((function(t){return t.y})).y((function(t){return t.x})),d=r.append("svg").attr("viewBox",[-s,-i,900,16]).style("font-size","12px").style("user-select","none"),p=d.append("g").attr("fill","none").attr("stroke","#3DCFA3").attr("stroke-opacity",.4).attr("stroke-width",1.5),h=d.append("g").attr("cursor","pointer").attr("pointer-events","all");return n.x0=75,n.y0=0,n.descendants().forEach((function(t,e){t.id=e,t._children=t.children,t.depth&&7!==t.data.name.length&&(t.children=null)})),function t(e){var r=u.i&&u.i.altKey?2500:250,f=n.descendants().reverse(),m=n.links();c(n);var g=n,v=n;n.eachBefore((function(t){t.x<g.x&&(g=t),t.x>v.x&&(v=t)}));var y=v.x-g.x+i+o,_=d.transition().duration(r).attr("viewBox",[-s,g.x-i,900,y]).tween("resize",window.ResizeObserver?null:function(){return function(){return d.dispatch("toggle")}}),b=h.selectAll("g").data(f,(function(t){return t.id})),x=b.enter().append("g").attr("data-id",(function(t){return t.id})).attr("transform",(function(t){return"translate(".concat(e.y0,",").concat(e.x0,")")})).attr("fill-opacity",0).attr("stroke-opacity",0).on("click",(function(e){e.children=e.children?null:e._children,t(e)}));x.append("circle").attr("r",2.5).attr("fill",(function(t){return t._children,"#3DCFA3"})).attr("stroke-width",10),x.append("text").attr("dy","0.31em").attr("x",(function(t){return t._children?-6:6})).attr("text-anchor",(function(t){return t._children?"end":"start"})).attr("fill","#fff").text((function(t){return"".concat(t.data.name," ").concat(a(t.data.value||0))})).clone(!0).lower().attr("stroke-linejoin","round").attr("stroke-width",3).attr("stroke","#2B2B2B"),b.merge(x).transition(_).attr("transform",(function(t){return"translate(".concat(t.y,",").concat(t.x,")")})).attr("fill-opacity",1).attr("stroke-opacity",1),b.exit().transition(_).remove().attr("transform",(function(t){return"translate(".concat(e.y,",").concat(e.x,")")})).attr("fill-opacity",0).attr("stroke-opacity",0);var w=p.selectAll("path").data(m,(function(t){return t.target.id})),k=w.enter().append("path").attr("d",(function(t){var r={x:e.x0,y:e.y0};return l({source:r,target:r})}));w.merge(k).transition(_).attr("d",(function(t){var e=t.target._children&&t.target._children.length>0,r=h.select('[data-id="'.concat(t.target.id,'"]')).node().getBBox(),n={x:t.target.x,y:t.target.y-r.width};return l(e?{source:t.source,target:n}:{source:t.source,target:t.target})})),w.exit().transition(_).remove().attr("d",(function(t){var r={x:e.x,y:e.y};return l({source:r,target:r})})),n.eachBefore((function(t){t.x0=t.x,t.y0=t.y}))}(n),d.node()}function d(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function p(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){d(i,n,a,o,s,"next",t)}function s(t){d(i,n,a,o,s,"throw",t)}o(void 0)}))}}function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){m(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var g={title:"Cost Analysis",components:{CaretIcon:s.a,CaretLeftIcon:s.b,Checkbox:c.a,DateRangeToggle:c.c,FilterDropdown:c.d,Loader:c.e,TimeSlider:c.h},data:function(){return{loaded:!1,showPageOpts:!1,showEmbed:!1,timeFilter:{start:null,end:null},minuteFilterLbl:"60 minutes",showMinuteFilter:!1,axiosSrc:null,dataError:null,dataFilters:{trigger:6,start_hour:8,stop_hour:16,start_date:"",stop_date:"",node_type:"Customer",node_id:"ad9b565d-9082-4808-99cd-32f2f09f63f2"}}},computed:f(f(f({},Object(i.d)({user:function(t){return t.user},company:function(t){return t.user.company},summary:function(t){return t.homepage.summary},rangeFilter:function(t){return t.homepage.rangeFilter}})),Object(i.b)({api_header:"backend/api_header",api_customer_summary:"backend/api_customer_summary"})),{},{settings:function(){return this.user.company?this.user.company.settings:null},baseUrl:function(){return Object(o.c)()},minuteFilters:function(){return[60].map((function(t){return{value:t,label:"".concat(t," minutes")}}))}}),methods:f(f({},Object(i.c)({setSummary:"homepage/setSummary",setRange:"homepage/setRange"})),{},{backTo:function(){this.$router.back()},rangeSelect:function(t,e,r){this.setRange(t),this.dataFilters.start_date=e.toISOString(),this.dataFilters.stop_date=r.toISOString(),this.axiosSrc&&this.axiosSrc.cancel("Date range selected"),this.renderTree(!0)},toggleEmbed:function(t){t&&(this.showPageOpts=!1),this.showEmbed=t},renderTree:function(){var t=arguments,e=this;return p(a.a.mark((function r(){var n,i,o,s,c,u,d,p;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=t.length>0&&void 0!==t[0]&&t[0],i=["building_country","building_city"],s={_:o=[]},e.loaded=!1,null!=e.summary&&!n){r.next=23;break}return e.axiosSrc=axios.CancelToken.source(),r.next=7,axios.post(e.api_customer_summary,e.dataFilters,e.api_header(e.axiosSrc.token));case 7:if(c=r.sent,(u=c.data).building_summary){r.next=15;break}return e.dataError=u,e.loaded=!0,r.abrupt("return");case 15:if(!u.building_summary||0!=u.building_summary.length){r.next=21;break}return e.dataError="No results",e.loaded=!0,r.abrupt("return");case 21:e.dataError=null,e.setSummary(u);case 23:d={ID:"",name:e.summary.customer,children:[]},p=e.summary.building_summary,d.value=p.map((function(t){return t.opportunity_cost})).reduce((function(t,e){return t+e}),0),p.forEach((function(t){t.name=t.building_name,t.value=t.opportunity_cost,i.reduce((function(e,r){if(!e[t[r]]&&(e[t[r]]={_:[]},t[r])){var n,a=(m(n={},"name",t[r]),m(n,"children",e[t[r]]._),n);if("building_country"===r){var i=p.filter((function(e){return e[r]==t[r]}));a.value=i.map((function(t){return t.opportunity_cost})).reduce((function(t,e){return t+e}),0),a.building_country=!0}else if("building_city"===r){var o=p.filter((function(e){return e[r]==t[r]}));a.value=o.map((function(t){return t.opportunity_cost})).reduce((function(t,e){return t+e}),0),a.building_city=!0}e._.push(a)}return e[t[r]]}),s)._.push(t)})),d.children=o,e.loaded=!0,setTimeout((function(){l("#cost-tree",d)}),100);case 30:case"end":return r.stop()}}),r)})))()},timeStartChange:function(t){this.dataFilters.start_hour=hour,this.timeFilter.start=t,this.axiosSrc&&this.axiosSrc.cancel("Start time updated"),this.renderTree(!0)},timeEndChange:function(t){this.dataFilters.stop_hour=hour,this.timeFilter.end=t,this.axiosSrc&&this.axiosSrc.cancel("End time updated"),this.renderTree(!0)},filterMinute:function(t){var e=this.minuteFilters.find((function(e){return e.value==t}));this.showMinuteFilter=!1,this.minuteFilterLbl=e.label}}),created:function(){var t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23);this.dataFilters.start_date=e.toISOString(),this.dataFilters.stop_date=r.toISOString(),null==this.rangeFilter&&this.setRange("today"),this.company&&this.company.ref_id&&(this.dataFilters.node_id=this.company.ref_id)},mounted:function(){this.renderTree()}},v=(r(93),r(3)),y=Object(v.a)(g,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[r("div",{staticClass:"graph-header"},[r("div",{staticClass:"page-back"},[r("div",{staticClass:"back-button",on:{click:t.backTo}},[r("button",{staticClass:"btn btn-primary btn-small"},[r("caret-left-icon")],1),t._v("\n                Back\n            ")])]),t._v(" "),r("span",{staticClass:"page-opt-trigger",attrs:{role:"button"},on:{click:function(e){t.showPageOpts=!t.showPageOpts}}},[r("span",{staticClass:"dot"}),t._v(" "),r("span",{staticClass:"dot"}),t._v(" "),r("span",{staticClass:"dot"})]),t._v(" "),r("transition",{attrs:{name:"fadeUp"}},[t.showPageOpts?r("div",{staticClass:"page-opt-panel"},[r("ul",[r("li",[r("a",{on:{click:function(e){return t.toggleEmbed(!0)}}},[t._v("Embed")])])])]):t._e()])],1),t._v(" "),r("div",{staticClass:"graph-content"},[t._m(0),t._v(" "),r("date-range-toggle",{attrs:{active:t.rangeFilter},on:{select:t.rangeSelect}}),t._v(" "),t.loaded?[t.dataError?r("div",{staticClass:"error-display",staticStyle:{height:"40vh"}},[r("p",[t._v(t._s(t.dataError))]),t._v(" "),r("a",{staticClass:"btn btn-primary",staticStyle:{"align-self":"center"},attrs:{href:"javascript:;"},on:{click:function(e){return t.renderTree(!0)}}},[t._v("Retry")])]):r("div",{attrs:{id:"cost-tree"}})]:r("div",{staticStyle:{height:"40vh"}},[r("loader",{attrs:{show:!t.loaded,type:"ripple"}})],1),t._v(" "),r("div",{staticClass:"bottom-filters"},[r("time-slider",{attrs:{from:t.settings?t.settings.start_time:null,to:t.settings?t.settings.end_time:null},on:{startChanged:t.timeStartChange,endChanged:t.timeEndChange}}),t._v(" "),r("span",{staticClass:"graph-filter",on:{click:function(e){t.showMinuteFilter=!t.showMinuteFilter}}},[t._v("\n                "+t._s(t.minuteFilterLbl?t.minuteFilterLbl:"Select")+"\n                "),r("span",{staticClass:"caret"},[r("caret-icon")],1),t._v(" "),r("filter-dropdown",{attrs:{filters:t.minuteFilters,position:"top",show:t.showMinuteFilter},on:{onSelect:t.filterMinute}})],1)],1)],2),t._v(" "),r("div",{staticClass:"graph-footer"},[r("div",{staticClass:"left-options"}),t._v(" "),r("div",{staticClass:"right-options"},[r("checkbox",{attrs:{label:"Save to report"}})],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"chart-header"},[e("span",{staticClass:"chart-title"},[this._v("Cost Analysis")])])}],!1,null,"309c9875",null);e.default=y.exports},38:function(t,e,r){var n=r(94);"string"==typeof n&&(n=[[t.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(8)(n,a);n.locals&&(t.exports=n.locals)},93:function(t,e,r){"use strict";r(38)},94:function(t,e,r){(t.exports=r(7)(!1)).push([t.i,"#cost-tree[data-v-309c9875]{margin:24px auto;max-width:100%;width:1024px}",""])}}]);