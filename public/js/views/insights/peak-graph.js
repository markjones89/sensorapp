(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{258:function(t,e,a){"use strict";a.r(e);var r=a(5),i=a(2),n=a(3),s=a(20),o=a(6);function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){h(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var p={title:"Peak Chart",components:{CaretIcon:o.a,CaretLeftIcon:o.b,Checkbox:n.a,DateRangeToggle:n.c,GraphFilter:n.e,Modal:n.h,TimeSlider:n.i,HierarchyGraph:s.b},data:function(){return{barChart:null,floorSummary:null,axiosSrc:null,showPageOpts:!1,showEmbed:!1,rangeFilter:{type:"today",start:null,end:null},timeFilter:{start:null,end:null},locations:[],locationFilter:null,minuteFilter:60,dataLoaded:!1,dataFilters:{trigger:6,start_hour:8,stop_hour:16,start_date:"",stop_date:"",node_type:"Customer",node_id:"ad9b565d-9082-4808-99cd-32f2f09f63f2"}}},computed:d(d(d({},Object(r.e)({user:function(t){return t.user},company:function(t){return t.user.company},settings:function(t){return t.user.company?t.user.company.settings:null},summary:function(t){return t.homepage.summary},cp_range:function(t){return t.homepage.rangeFilter},cp_start_time:function(t){return t.homepage.startTime},cp_end_time:function(t){return t.homepage.endTime},peakSummary:function(t){return t.peakchart.summary}})),Object(r.c)({api_header:"backend/api_header",api_customer_summary:"backend/api_customer_summary",api_graph_view:"backend/api_graph_view"})),{},{baseUrl:function(){return Object(i.d)()},minuteFilters:function(){return[60].map((function(t){return{value:t,label:"".concat(t," minutes")}}))},selectedLocation:function(){var t;return null===(t=this.locationFilter)||void 0===t?void 0:t.value}}),methods:d(d({},Object(r.d)({setSummary:"homepage/setSummary",setPeakSummary:"peakchart/setSummary"})),{},{backTo:function(){this.$router.back()},toggleEmbed:function(t){t&&(this.showPageOpts=!1),this.showEmbed=t},rangeSelect:function(t,e,a){this.dataLoaded=!1,this.dataFilters.start_date=Object(i.m)(e),this.dataFilters.stop_date=Object(i.l)(a)},chartLoaded:function(t,e,a){a||(this.setSummary(t),this.setPeakSummary(e));var r=JSON.parse(JSON.stringify(this.summary)),i=r.building_summary,n=[{label:r.customer,value:r.customer}];l(new Set(i.map((function(t){return t.building_country})).sort())).forEach((function(t){n.push({label:t,value:t,country:!0}),l(new Set(i.filter((function(e){return e.building_country==t})).map((function(t){return t.building_city})).sort())).forEach((function(e){n.push({label:e,value:e,city:!0}),n.push.apply(n,l(i.filter((function(a){return a.building_country==t&&a.building_city==e})).map((function(t){return{label:t.building_name,value:t.building_name,building:!0}})).sort()))}))})),null==this.locationFilter&&(this.locationFilter=n[0]),this.locations=n,this.dataLoaded=!0},locFilter:function(t,e,a){this.locationFilter=a},timeStartChange:function(t,e){this.dataLoaded=!1,this.dataFilters.start_hour=e},timeEndChange:function(t,e){this.dataLoaded=!1,this.dataFilters.stop_hour=e},filterMinute:function(t){this.minuteFilter=t},graphRoute:function(t,e){this.$router.push({name:t,query:e})},viewCostAnalysis:function(){this.$router.push({name:"cost-analysis"})},toLive:function(){this.$router.push({name:"occupancy"})}}),created:function(){if(this.cp_range.type)this.rangeFilter=JSON.parse(JSON.stringify(this.cp_range)),this.dataFilters.start_date=this.rangeFilter.start,this.dataFilters.stop_date=this.rangeFilter.end;else{var t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23);this.rangeFilter.type="today",this.rangeFilter.start=this.dataFilters.start_date=Object(i.m)(e),this.rangeFilter.end=this.dataFilters.stop_date=Object(i.l)(a)}if(this.cp_start_time?(this.dataFilters.start_hour=this.timeFilter.start=this.cp_start_time,this.dataFilters.stop_hour=this.timeFilter.end=this.cp_end_time):this.settings&&(this.dataFilters.start_hour=this.timeFilter.start=Object(i.k)(this.settings.start_time),this.dataFilters.stop_hour=this.timeFilter.end=Object(i.k)(this.settings.end_time)),this.$route.query.name){var r=JSON.parse(JSON.stringify(this.$route.query));r.value=r.name,this.locationFilter=r}this.company&&this.company.ref_id&&(this.dataFilters.node_id=this.company.ref_id)},mounted:function(){}},m=a(4),f=Object(m.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("div",{staticClass:"graph-header"},[a("date-range-toggle",{attrs:{active:t.rangeFilter.type},on:{select:t.rangeSelect}}),t._v(" "),t.dataLoaded?a("div",{staticClass:"graph-filters"},[a("graph-filter",{attrs:{placeholder:"Select Location",filters:t.locations,chosen:t.selectedLocation,chosenAsSelected:!0},on:{onSelect:t.locFilter}}),t._v(" "),a("a",{staticClass:"btn btn-primary ml-12",attrs:{href:"javascript:;"},on:{click:t.viewCostAnalysis}},[t._v("Cost Analysis")])],1):t._e(),t._v(" "),a("span",{staticClass:"page-opt-trigger",attrs:{role:"button"},on:{click:function(e){t.showPageOpts=!t.showPageOpts}}},[a("span",{staticClass:"dot"}),t._v(" "),a("span",{staticClass:"dot"}),t._v(" "),a("span",{staticClass:"dot"})]),t._v(" "),a("transition",{attrs:{name:"fadeUp"}},[t.showPageOpts?a("div",{staticClass:"page-opt-panel"},[a("ul",[a("li",[a("a",{on:{click:function(e){return t.toggleEmbed(!0)}}},[t._v("Embed")])])])]):t._e()])],1),t._v(" "),a("div",{staticClass:"graph-content"},[a("div",{staticClass:"page-back"},[a("div",{staticClass:"back-button",on:{click:t.backTo}},[a("button",{staticClass:"btn btn-primary btn-small"},[a("caret-left-icon")],1),t._v("\n                Back\n            ")])]),t._v(" "),a("hierarchy-graph",{attrs:{custData:t.summary,floorData:t.peakSummary,locFilter:t.locationFilter,dataFilters:t.dataFilters},on:{dataLoaded:t.chartLoaded,routeTo:t.graphRoute}}),t._v(" "),a("div",{staticClass:"bottom-filters"},[a("time-slider",{attrs:{from:t.timeFilter.start,to:t.timeFilter.end},on:{startChanged:t.timeStartChange,endChanged:t.timeEndChange}}),t._v(" "),a("graph-filter",{attrs:{filters:t.minuteFilters,chosen:t.minuteFilter,chosenAsSelected:!0,position:"top"},on:{onSelect:t.filterMinute}})],1)],1),t._v(" "),a("div",{staticClass:"graph-footer"},[a("div",{staticClass:"left-options"},[a("button",{staticClass:"btn btn-primary btn-small",on:{click:t.toLive}},[t._v("Live")]),t._v(" "),a("button",{staticClass:"btn btn-primary btn-small"},[t._v("Insights")])]),t._v(" "),a("div",{staticClass:"right-options"},[a("checkbox",{attrs:{label:"Save to report"}})],1)])])}),[],!1,null,null,null);e.default=f.exports}}]);