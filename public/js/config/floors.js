(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{11:function(n,t,o){var r=o(33);"string"==typeof r&&(r=[[n.i,r,""]]);var e={hmr:!0,transform:void 0,insertInto:void 0};o(8)(r,e);r.locals&&(n.exports=r.locals)},32:function(n,t,o){"use strict";var r=o(11);o.n(r).a},33:function(n,t,o){(n.exports=o(7)(!1)).push([n.i,"#floor-list[data-v-22ab66fe] {\n  margin-top: 24px;\n}\n#floor-list #add-btn[data-v-22ab66fe] {\n  margin-top: 24px;\n}\n.floor[data-v-22ab66fe] {\n  font-size: 20px;\n  padding: 10px;\n  border-radius: 10px;\n  transition: background-color 0.24s linear;\n}\n.floor[data-v-22ab66fe]:hover {\n  background-color: rgba(255, 255, 255, 0.04);\n}\n.floor .floor-opts[data-v-22ab66fe] {\n  line-height: 13px;\n}\n.floor .floor-opts .floor-opt[data-v-22ab66fe] {\n  font-size: 13px;\n  cursor: pointer;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.floor .floor-opts .floor-opt[data-v-22ab66fe]:hover {\n  text-decoration: underline;\n}\n#plan-wrapper[data-v-22ab66fe] {\n  position: relative;\n  padding: 16px;\n}\n#plan-wrapper h2[data-v-22ab66fe] {\n  margin-bottom: 10px;\n}\n#plan-wrapper img[data-v-22ab66fe] {\n  display: block;\n  max-width: 100%;\n  pointer-events: none;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  background-color: #ffffff;\n}\n#plan-wrapper #back-btn[data-v-22ab66fe] {\n  margin-top: 24px;\n}",""])},83:function(n,t,o){"use strict";o.r(t);var r=o(0),e=o.n(r),a=o(2),i=o(5);function s(n,t,o,r,e,a,i){try{var s=n[a](i),l=s.value}catch(n){return void o(n)}s.done?t(l):Promise.resolve(l).then(r,e)}function l(n){return function(){var t=this,o=arguments;return new Promise((function(r,e){var a=n.apply(t,o);function i(n){s(a,r,e,i,l,"next",n)}function l(n){s(a,r,e,i,l,"throw",n)}i(void 0)}))}}var d="/api/floors",f={title:"Floors Setup",props:["bldg_id","bldg_name"],components:{Loader:a.a,Modal:a.c},data:function(){return{bldgName:null,floors:[],floor:null,listTransition:"fadeUp",loaded:!1,showEntry:!1,editMode:!1,entry:{id:null,fNo:1},showPlan:!1,planUrl:null,state:{saving:!1}}},computed:{baseUrl:function(){return Object(i.b)()},building:function(){return this.bldg_name?this.bldg_name:this.bldgName},floorList:function(){return this.floors.sort((function(n,t){return n.floor_no>t.floor_no?1:n.floor_no<t.floor_no?-1:0}))}},methods:{getBldgName:function(){var n=this;return l(e.a.mark((function t(){var o,r;return e.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get("/api/locations",{params:{id:n.bldg_id}});case 2:o=t.sent,r=o.data,n.bldgName=r.name;case 5:case"end":return t.stop()}}),t)})))()},getFloors:function(){var n=this;return l(e.a.mark((function t(){var o,r;return e.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get(d,{params:{bid:n.bldg_id}});case 2:o=t.sent,r=o.data,n.floors=r,n.loaded=!0;case 6:case"end":return t.stop()}}),t)})))()},toggleEntry:function(n){var t=this;this.showEntry=n,n&&setTimeout((function(){t.$refs.fNo.focus()}),0)},toggleSaving:function(n){this.state.saving=n},triggerAdd:function(){this.entry.id=null,this.entry.fNo=1,this.editMode=!1,this.toggleEntry(!0)},addFloor:function(){var n=this;return l(e.a.mark((function t(){return e.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.toggleSaving(!0),axios.post(d,{building:n.bldg_id,floor_no:n.entry.fNo}).then((function(t){n.toggleSaving(!1);var o=t.data;o.r&&(n.floors.push(o.data),n.toggleEntry(!1))}));case 2:case"end":return t.stop()}}),t)})))()},triggerEdit:function(n){var t=this.floors.find((function(t){return t.hid===n}));this.entry.id=n,this.entry.fNo=t.floor_no,this.editMode=!0,this.toggleEntry(!0)},upFloor:function(){var n=this;return l(e.a.mark((function t(){return e.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.toggleSaving(!0),axios.put("".concat(d,"/").concat(n.entry.id),{floor_no:n.entry.fNo}).then((function(t){if(n.toggleSaving(!1),t.data.r){var o=n.floors.find((function(t){return t.hid==n.entry.id}));o.floor_no=n.entry.fNo,o.ordinal_no=Object(i.e)(o.floor_no),n.toggleEntry(!1)}}));case 2:case"end":return t.stop()}}),t)})))()},delFloor:function(n){var t=this;return l(e.a.mark((function o(){var r;return e.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=t.floors.findIndex((function(t){return t.hid===n})),confirm("Remove Floor ".concat(t.floors[r].floor_no,"?"))&&(t.toggleSaving(!0),axios.delete("".concat(d,"/").concat(n)).then((function(n){t.toggleSaving(!1),n.data.r&&t.floors.splice(r,1)})));case 2:case"end":return o.stop()}}),o)})))()},upFloorPlan:function(n){this.entry.id=n,this.$refs.fpFile.click()},fpFileChange:function(){var n=this,t=n.$refs.fpFile.files[0];t&&n.upload(t,(function(t,o){t?o.r&&(n.floors.find((function(t){return t.hid===n.entry.id})).floor_plan=o.floor_plan):console.error(o)}))},upload:function(n,t){var o=this;return l(e.a.mark((function r(){var a;return e.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:(a=new window.FormData).append("floor_plan",n),a.append("id",o.entry.id),axios.post("".concat(d,"/plan"),a,{headers:{"Content-Type":"multipart/form-data"}}).then((function(n){return t(!0,n.data)})).catch((function(n){return t(!1,n)}));case 4:case"end":return r.stop()}}),r)})))()},togglePlan:function(n){this.showPlan=n,this.listTransition="fade"},viewFloorPlan:function(n,t){this.floor=this.floors.find((function(t){return t.hid===n})),this.togglePlan(!0)},viewSensors:function(n){this.$parent.$router.push({name:"sensors",query:{bid:this.bldg_id,fid:n},params:{bldg_name:this.bldg_name}})}},created:function(){this.bldg_name||this.getBldgName()},mounted:function(){this.getFloors()}},c=(o(32),o(1)),u=Object(c.a)(f,(function(){var n=this,t=n.$createElement,o=n._self._c||t;return o("div",{staticClass:"content"},[o("h1",[n._v(n._s(n.building?"Floors - "+n.building:"Floors"))]),n._v(" "),n.loaded?[o("transition",{attrs:{name:"fade",appear:""}},[n.showPlan?o("div",{attrs:{id:"plan-wrapper"}},[o("h2",[n._v(n._s(n.floor.ordinal_no+" Floor"))]),n._v(" "),o("img",{attrs:{src:n.baseUrl+"/plans/"+n.floor.floor_plan}}),n._v(" "),o("button",{staticClass:"btn btn-primary",attrs:{id:"back-btn"},on:{click:function(t){return n.togglePlan(!1)}}},[n._v("Back")])]):n._e()]),n._v(" "),o("transition",{attrs:{name:n.listTransition,appear:""}},[n.showPlan?n._e():o("div",{attrs:{id:"floor-list"}},[0===n.floorList.length?o("div",[n._v("No floors defined")]):n._l(n.floorList,(function(t){return o("div",{key:t.hid,staticClass:"floor"},[o("div",{staticClass:"floor-opts"},[o("a",{staticClass:"floor-opt",on:{click:function(o){return n.upFloorPlan(t.hid)}}},[n._v("Upload Floor Plan")]),n._v(" "),t.floor_plan?[o("a",{staticClass:"floor-opt",on:{click:function(o){return n.viewFloorPlan(t.hid,t.floor_plan)}}},[n._v("Floor Plan")]),n._v(" "),o("a",{staticClass:"floor-opt",on:{click:function(o){return n.viewSensors(t.hid)}}},[n._v("Sensors")])]:n._e(),n._v(" "),o("a",{staticClass:"floor-opt",on:{click:function(o){return n.triggerEdit(t.hid)}}},[n._v("Edit")]),n._v(" "),o("a",{staticClass:"floor-opt",on:{click:function(o){return n.delFloor(t.hid)}}},[n._v("Remove")])],2),n._v("\n                    "+n._s(t.ordinal_no+" Floor")+"\n                ")])})),n._v(" "),o("input",{ref:"fpFile",attrs:{type:"file",hidden:"",accept:"image/*"},on:{change:n.fpFileChange}}),n._v(" "),o("button",{staticClass:"btn btn-primary",attrs:{id:"add-btn"},on:{click:n.triggerAdd}},[n._v("Add Floor")])],2)])]:n._e(),n._v(" "),o("modal",{attrs:{show:n.showEntry},on:{close:function(t){return n.toggleEntry(!1)}},scopedSlots:n._u([{key:"header",fn:function(){return[o("h2",[n._v(n._s(n.editMode?"Edit":"Add")+" Floor")])]},proxy:!0},{key:"footer",fn:function(){return[n.editMode?o("button",{staticClass:"btn btn-primary",attrs:{disabled:n.state.saving},on:{click:n.upFloor}},[n._v(n._s(n.state.saving?"Updating...":"Update"))]):o("button",{staticClass:"btn btn-primary",attrs:{disabled:n.state.saving},on:{click:n.addFloor}},[n._v(n._s(n.state.saving?"Adding...":"Add"))])]},proxy:!0}])},[n._v(" "),o("div",{attrs:{id:"entry-wrapper"}},[o("div",{staticClass:"input-field"},[o("label",[n._v("Floor No.")]),n._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:n.entry.fNo,expression:"entry.fNo"}],ref:"fNo",attrs:{type:"number"},domProps:{value:n.entry.fNo},on:{input:function(t){t.target.composing||n.$set(n.entry,"fNo",t.target.value)}}})])])]),n._v(" "),o("loader",{attrs:{show:!n.loaded,type:"ripple"}})],2)}),[],!1,null,"22ab66fe",null);t.default=u.exports}}]);